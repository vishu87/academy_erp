Directive.$inject=["$rootScope"],$(document).on("click",".datepicker",function(){$(this).datepicker({format:"dd-mm-yyyy",todayHighlight:!0,autoclose:!0}),$(this).datepicker("show")}),$(function(){$("li.parent").on("mouseover",function(){var e=$(this),t=$("> ul",e),e=e.position();t.css({top:e.top,left:92})})}),$(document).on("click",".toggle-menu",function(){$(".page-menu").toggleClass("open"),$(this).toggleClass("open-menu")});var app=angular.module("app",["ngFileUpload","jcs-autoValidate","uiCropper","ngSanitize"]);function Directive(e){return{require:"ngModel",link:function(t,e,a,n){a.id,ClassicEditor.create(document.querySelector("#editor_data")).then(e=>{(window.editor=e).setData(t.editor_data)})}}}angular.module("jcs-autoValidate").run(["defaultErrorMessageResolver",function(e){e.getErrorMessages().then(function(e){e.PatternMobile="Please fill a valid mobile number",e.PatternPin="Please fill a valid pin code",e.patternInt="Please fill a numeric value",e.patternFloat="Please fill a numeric/decimal value",e.patternDate="Please fill a valid date in DD-MM-YYYY format",e.PatternUsername="This field allows alphanumeric and . only between 4 to 20 chars"})}]),app.directive("convertToNumber",function(){return{require:"ngModel",link:function(e,t,a,n){n.$parsers.push(function(e){return null!=e?parseInt(e,10):null}),n.$formatters.push(function(e){return null!=e?""+e:null})}}}),app.directive("capitalize",function(){return{require:"ngModel",link:function(e,a,t,n){function o(e){var t=(e=null==e?"":e).toUpperCase();return t!==e&&(e=a[0].selectionStart,n.$setViewValue(t),n.$render(),a[0].selectionStart=e,a[0].selectionEnd=e),t}n.$parsers.push(o),o(e[t.ngModel])}}}),app.directive("tablePaginate",["$compile",function(e){return{restrict:"EA",template:'<div class="row">        <div class="col-md-6" >        <div class="total-count" ng-if="filter.max_page > 0">Showing <span>{{filter.max_per_page*(filter.page_no-1) + 1}} - {{filter.max_per_page*filter.page_no < total ? filter.max_per_page*filter.page_no : total}}</span> of <span>{{total}}</span></div>        </div>        <div class="col-md-6" style="text-align: right;">          <button class="btn fl-btn" ng-click="filter.show = (filter.show ? false:true )" ng-class=" filter.show ? \'open\' :\'\' "><i class="icons icon-grid"></i> Filter</button>          <ul class="pagination" ng-if="filter.max_page > 1">            <li class="page-item">              <a class="page-link" href="javascript:;" ng-click="setPage(1)"> << </a>            </li>            <li class="page-item">              <a class="page-link" href="javascript:;" ng-click="setPage(filter.page_no - 1)"> < </a>            </li>            <li class="page-item" ng-repeat="page in pages">              <a class="page-link" href="javascript:;" ng-click="setPage(page)" ng-class="page == filter.page_no ? \'active\' : \'\' ">{{page}}</a>            </li>            <li class="page-item">              <a class="page-link" href="javascript:;" ng-click="setPage(filter.page_no + 1)"> > </a>            </li>            <li class="page-item">              <a class="page-link" href="javascript:;" ng-click="setPage(filter.max_page)"> >> </a>            </li>          </ul>      </div>      </div>',link:function(t,e,a){t.setPagination=function(){var e=[];1==t.filter.page_no?(e.push(1),e.push(2),2<t.filter.max_page&&e.push(3)):(t.filter.max_page==t.filter.page_no&&2<t.filter.max_page&&e.push(t.filter.page_no-2),e.push(t.filter.page_no-1),e.push(t.filter.page_no),t.filter.max_page!=t.filter.page_no&&e.push(t.filter.page_no+1)),t.pages=e},t.setPagination(),t.setPage=function(e){e<1||e>t.filter.max_page||e==t.page_number||(t.filter.page_no=e,t.setPagination(),t.getList())}}}}]),app.directive("thSort",["$compile",function(e){return{restrict:"EA",template:function(e,t){return'<span style="display:block; cursor:pointer" ng-click="setOrder(\''+t.columnId+"')\">"+t.columnName+" <span ng-if=\"filter.order_by == '"+t.columnId+'\'"><i class="icons icon-arrow-up" ng-if="filter.order_type == \'ASC\'"></i><i class="icons icon-arrow-down" ng-if="filter.order_type == \'DESC\'"></i></span></span>'},link:function(t,e,a){t.setOrder=function(e){e==t.filter.order_by?t.filter.order_type="ASC"==t.filter.order_type?"DESC":"ASC":(t.filter.order_by=e,t.filter.order_type="ASC"),t.filter.page_no=1,t.getList()}}}}]),app.directive("fileUpload",["$compile",function(e){return{restrict:"EA",template:function(e,t){return console.log(t),'<button type="button" class="button btn btn-primary" ngf-select="uploadFile($file, \''+t.fieldName+"', "+t.objectName+' )" ladda="uploading" ng-if="!formData.'+t.fieldName+'">Upload</button>           <a type="button" class="btn btn-primary" href="{{ formData.'+t.fieldName+'_url}}" ng-if="formData.'+t.fieldName+'" target="_blank">View</a>           <a type="button" class="btn btn-danger" ng-click="removeFile(\''+t.fieldName+"', "+t.objectName+')" ng-if="formData.'+t.fieldName+'">Remove</a>'},link:function(o,e,t){o.uploadFile=function(e,t,a){o.uploading=!0;var n=base_url+"/upload/file";o.upload.upload({url:n,data:{file:e}}).then(function(e){e.data.success?(a[t]=e.data.file,a[t+"_url"]=e.data.file_url):alert(e.data.message),o.uploading=!1},function(e){console.log("Error status: "+e.status),o.uploading=!1},function(e){o.uploading_percentage=parseInt(100*e.loaded/e.total)+"%"})},o.removeFile=function(e,t){t[e]="",t[e+"_url"]=""}}}}]),app.directive("eBarChart",["$compile",function(e){return{restrict:"EA",template:'<div class="chartarea" style="width:550px; height:300px"></div>',link:function(e,t,a){for(var t=t[0].querySelectorAll(".chartarea"),n=(console.log(a),a.dataid),o=e[a.datagraph],i=(angular.forEach(t,function(e,t){angular.element(e).attr("id",n)}),[]),s=[],r=0;r<o.length;r++)i.push(o[r].label),s.push(o[r].value);options={grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:i},yAxis:{type:"value"},tooltip:{trigger:"item",formatter:"{b} : {c}"},series:[{data:s,type:"bar",label:{normal:{show:!0,position:"top",distance:15,align:"left",verticalAlign:"middle",rotate:90,formatter:function(e){var t=e.data;return t<1e3?e.data:t<1e5?(e.data/1e3).toFixed(1)+" K":(e.data/1e5).toFixed(1)+" L"},fontSize:12,rich:{name:{textBorderColor:"#fff"}}}}}]},setTimeout(function(){echarts.init(document.getElementById(n)).setOption(options)},2e3)}}}]),app.directive("eLineChart",["$compile",function(e){return{restrict:"EA",template:'<div class="chartarea" style="width:100%; height:250px;"></div>',link:function(e,t,a){for(var t=t[0].querySelectorAll(".chartarea"),n=a.dataid,o=e[a.datagraph],e=(angular.forEach(t,function(e,t){angular.element(e).attr("id",n)}),o.labels),i=[],s=o.legends,r=0;r<o.values.length;r++)i.push({name:s[r],data:o.values[r],type:"line"});console.log(i),options={darkMode:"decal",grid:{top:"3%",left:"3%",right:"4%",bottom:"15%",containLabel:!0},legend:{data:s,bottom:-200},xAxis:{type:"category",data:e},yAxis:{type:"value"},tooltip:{trigger:"axis"},series:i},setTimeout(function(){echarts.init(document.getElementById(n)).setOption(options)},2e3)}}}]),app.filter("INR",function(){return function(e){var t,a,n;if(!isNaN(e))return t=(currency_format,""),a=(e=e.toString().split("."))[0].substring(e[0].length-3),""!=(n=e[0].substring(0,e[0].length-3))&&(a=","+a),n=n.replace(/\B(?=(\d{2})+(?!\d))/g,",")+a,1<e.length&&(n+="."+e[1]),t+n}}),app.directive("ckeditor",Directive),app.run(["$rootScope","DBService",function(a,n){a.studentDetail=function(e){n.getCall("/api/student/get-info/"+e).then(function(e){e.success?(a.student=e.student,$("#student_personal_detail").modal("show")):alert(e.message)})},a.trimText=function(e,t){return e.length>t?e.substr(0,t)+"...":e},a.showInfo=function(e,t){a.modal_info=e,a.modal_type=t,$("#infoModal").modal("show")},a.viewPayment=function(e){n.getCall("/api/student/payment/view-payment/"+e).then(function(e){a.payment=e.payment,$("#viewPaymentModal").modal("show")})},a.sendPaymentEmail=function(e){n.getCall("/api/student/payment/view-payment/"+e).then(function(e){a.payment=e.payment,$("#viewPaymentModal").modal("show")})},a.sendPaymentEmail=function(t){bootbox.confirm("Are you sure to mail payment receipt?",e=>{e&&(a.processing_pay_mail=!0,n.postCall({payment_id:t},"/api/student/payment-email").then(function(e){bootbox.alert(e.message),a.processing_pay_mail=!1}))})}}]),app.service("DBService",["$http","$rootScope",function(a,e){this.getCall=function(e){return a({method:"GET",url:base_url+e,headers:{apiToken:api_key,clientId:client_id}}).then(function(e){if(200==e.status)return e.data})},this.postCall=function(e,t){return a({method:"POST",url:base_url+t,data:e,headers:{apiToken:api_key,clientId:client_id}}).then(function(e){if(200==e.status)return e.data})}}]),app.controller("Reg_controller",["$scope","$http","DBService",function(t,e,a){t.processing=!1,t.payment_code=payment_code,t.formData={name:"Vashisths",date:"10",month:"10",year:"2009",gender:"1",father_name:"RK",mother_name:"Alka",prim_email:"vishu.iitd@gmail.com",prim_mobile:"9421345321",prim_relation_to_student:1,address:"Asdada,asda dad , asda",state_id:"10",city_id:"3",pin_code:"265122",training_city_id:"3",training_center_id:"8"},t.coupon_code="",t.coupon_code_message="",t.tab=1,t.init=function(){a.getCall("/api/get-state-city-center").then(function(e){e.success?(t.cities=e.cities,t.centers=e.centers,t.groups=e.groups,t.states=e.states):bootbox.alert(e.message)})},t.getStateCity=function(){a.getCall("/api/cities/"+t.formData.address_state_id).then(function(e){e.success?t.state_cities=e.cities:bootbox.alert(e.message)})},t.resetPayment=function(){t.getPaymentOptions(),t.payment_items=[];for(var e=t.total_amount=0;e<t.payment_options.length;e++)t.payment_options[e].type_id=""},t.getPaymentOptions=function(){a.postCall({group_id:t.formData.group_id,payment_code:t.payment_code},"/api/subscriptions/get-payment-options").then(function(e){t.payment_options=e.payment_options,t.getPaymentItems()})},t.checkCoupon=function(){a.postCall({coupon_code:t.formData.coupon_code,group_id:t.formData.group_id},"/api/subscriptions/check-coupon").then(function(e){e.success?(t.coupon_code=t.formData.coupon_code,t.getPaymentItems()):alert(e.message)})},t.removeCoupon=function(){t.formData.coupon_code="",t.coupon_code="",t.coupon_code_message="",t.getPaymentItems()},t.getPaymentItems=function(){a.postCall({coupon_code:t.coupon_code,categories:t.payment_options,group_id:t.formData.group_id,payment_code:t.payment_code},"/api/subscriptions/get-payment-items").then(function(e){t.payment_items=e.payment_items,t.total_amount=e.total_amount,t.total_discount=e.total_discount,t.coupon_code_message=e.coupon_code_message})},t.onSubmit=function(){t.processing=!0,t.formData.payment_items=t.payment_items,a.postCall(t.formData,"/api/registrations/store").then(function(e){e.success?(t.reg_data=e.reg_data,t.formData.id=t.reg_data.id,t.tab=2):bootbox.alert(e.message),t.processing=!1})},t.showSizeChart=function(){$("#kit_size").modal("show")},t.createOrder=function(){t.placing_order=!0,a.postCall({type:"registration",payment_gateway:"razorpay",registration_id:t.formData.id,total_amount:t.total_amount,payment_items:t.payment_items},"/api/subscriptions/create-order").then(function(e){t.order_id=e.order_id,t.key=e.key,t.startPayment(),t.placing_order=!1})},t.startPayment=function(){var e={key:t.key,amount:100*t.total_amount,currency:"INR",name:t.reg_data.name,description:"BBFS Registration Payment",image:"https://www.bbfootballschools.com/images/logo.png",order_id:t.order_id,handler:function(e){t.processing_order=!0,t.transaction_id=e.razorpay_payment_id,a.postCall({order_id:t.order_id,transaction_id:e.razorpay_payment_id},"/api/subscriptions/process-order").then(function(e){t.datetime=e.datetime,e.success?t.tab=3:alert(e.message),t.processing_order=!1})},prefill:{name:t.reg_data.name,email:t.reg_data.prim_email,contact:t.reg_data.prim_mobile},notes:{address:"BBFS"},theme:{color:"#F37254"},modal:{ondismiss:function(){alert("Payment has been cancelled. Kindly retry")}}};new Razorpay(e).open()}}]),app.controller("Lead_controller",["$scope","$http","DBService","Upload",function(a,e,t,n){a.tab=1,a.formData={},a.init=function(){t.getCall("/api/get-state-city-center").then(function(e){e.success?(a.cities=e.cities,a.centers=e.centers,a.groups=e.groups,a.states=e.states):bootbox.alert(e.message)})},a.uploadDocument=function(e){var t=base_url+"/uploads/file";n.upload({url:t,data:{file:e}}).then(function(e){e.data.success?(a.formData.document_url=e.data.url,a.formData.document=e.data.path):alert(e.data.message),a.uploading_file=!1},function(e){a.uploading_file=!1},function(e){a.uploading_percentage=parseInt(100*e.loaded/e.total)+"%"})},a.onSubmit=function(){a.processing=!0,a.formData.lead_for=a.lead_for,a.formData.type="scholarship",t.postCall(a.formData,"/api/open-lead/store-demo").then(function(e){e.success?a.tab=2:bootbox.alert(e.message),a.processing=!1})}}]),app.controller("Demo_controller",["$scope","$http","DBService",function(t,e,a){t.processing=!1,t.formData={},t.init=function(){a.getCall("/api/get-state-city-center").then(function(e){e.success?(t.cities=e.cities,t.centers=e.centers,t.groups=e.groups):bootbox.alert(e.message)})},t.onSubmit=function(){t.processing=!0,t.formData.type="demo-schedule",a.postCall(t.formData,"/api/open-lead/store-lead").then(function(e){e.success?(bootbox.alert(e.message),t.tab=2):bootbox.alert(e.message),t.processing=!1})},t.schedule=function(){a.getCall("/api/open-lead/get-schedule/"+t.formData.group_id).then(function(e){e.success?(t.visit_dates=e.visit_dates,t.visit_time=e.visit_time):bootbox.alert(e.message)})}}]),app.controller("RenewalCtrl",["$scope","$http","$timeout","DBService",function(t,e,a,n){t.payment_code=payment_code,t.filter={mobile_number:"9634628573"},t.step=1,t.key="",t.students=[],t.student={},t.sub={},t.sub_index=-1,t.show_success=!1,t.datetime="",t.formData={},t.coupon_code="",t.clickStep=function(e){t.step=e},t.submitStep1=function(){10!=t.filter.mobile_number.length?alert("Please fill 10 digit mobile number"):(t.processing=!0,n.postCall({mobile_number:t.filter.mobile_number},"/api/renewal/search").then(function(e){t.students=e.students,t.processing=!1,0<t.students.length?t.step=2:alert("No students found with this number")}))},t.selectStudent=function(e){t.student=e,t.payment_items=[],t.step=3,t.getPaymentOptions()},t.getPaymentOptions=function(){n.postCall({group_id:t.student.group_id,payment_code:t.payment_code},"/api/subscriptions/get-payment-options").then(function(e){t.payment_options=e.payment_options,t.getPaymentItems()})},t.checkCoupon=function(){n.postCall({coupon_code:t.formData.coupon_code,group_id:t.student.group_id},"/api/subscriptions/check-coupon").then(function(e){e.success?(t.coupon_code=t.formData.coupon_code,t.getPaymentItems()):alert(e.message)})},t.removeCoupon=function(){t.formData.coupon_code="",t.coupon_code="",t.coupon_code_message="",t.getPaymentItems()},t.getPaymentItems=function(){n.postCall({coupon_code:t.coupon_code,categories:t.payment_options,group_id:t.student.group_id,payment_code:t.payment_code},"/api/subscriptions/get-payment-items").then(function(e){t.payment_items=e.payment_items,t.total_amount=e.total_amount,t.total_discount=e.total_discount,t.coupon_code_message=e.coupon_code_message})},t.createOrder=function(){t.placing_order=!0,n.postCall({type:"renewal",payment_gateway:"razorpay",student_id:t.student.id,total_amount:t.total_amount,payment_items:t.payment_items},"/api/subscriptions/create-order").then(function(e){t.order_id=e.order_id,t.key=e.key,t.startPayment(),t.placing_order=!1})},t.startPayment=function(){var e={key:t.key,amount:100*t.total_amount,currency:"INR",name:t.student.name,description:"BBFS Registration Payment",image:"https://www.bbfootballschools.com/images/logo.png",order_id:t.order_id,handler:function(e){t.processing_order=!0,t.transaction_id=e.razorpay_payment_id,n.postCall({order_id:t.order_id,transaction_id:e.razorpay_payment_id},"/api/subscriptions/process-order").then(function(e){t.datetime=e.datetime,e.success?t.show_success=!0:alert(e.message),t.processing_order=!1})},prefill:{name:t.student.name,email:"",contact:t.filter.mobile_number},notes:{address:"BBFS"},theme:{color:"#F37254"},modal:{ondismiss:function(){alert("Payment has been cancelled. Kindly retry")}}};new Razorpay(e).open()}}]),app.controller("SignUp_controller",["$scope","$http","$timeout","DBService",function(t,e,a,n){t.tab=1,t.search=!1,t.formData={},t.onSubmit=function(e){t.processing=!0,t.false=!0,n.postCall({email:t.formData.email},"/api/sign-up/search").then(function(e){e.success?(t.tab=2,t.message=e.message,$("#success_message").html(e.message)):bootbox.alert(e.message),t.processing=!1,t.search=!0})},t.forgetPassword=function(){t.processing=!0,t.false=!0,n.postCall(t.formData,"/forget-password").then(function(e){e.success?(bootbox.alert(e.message),t.found=e.found):bootbox.alert(e.message),t.processing=!1,t.search=!0})}}]),app.controller("ClientPaymentCtrl",["$scope","$http","$timeout","DBService",function(t,e,a,n){t.payment_code=payment_code,t.invalid=!1,t.show_success=!1,t.init=function(){t.loading=!0,n.postCall({payment_code:t.payment_code},"/api/subscriptions/get-payment").then(function(e){e.success?(t.student=e.student,t.payment=e.payment,t.total_amount=e.total_amount,t.total_discount=e.total_discount):t.invalid=!0,t.loading=!1})},t.init(),t.createOrder=function(){t.placing_order=!0,n.postCall({type:"renewal",payment_gateway:"razorpay",student_id:t.payment.student_id,payment_id:t.payment.id,total_amount:t.total_amount},"/api/subscriptions/create-order").then(function(e){t.order_id=e.order_id,t.key=e.key,t.startPayment(),t.placing_order=!1})},t.startPayment=function(){var e={key:t.key,amount:100*t.total_amount,currency:"INR",name:t.student.name,description:"BBFS Registration Payment",image:"https://www.bbfootballschools.com/images/logo.png",order_id:t.order_id,handler:function(e){t.processing_order=!0,t.transaction_id=e.razorpay_payment_id,n.postCall({order_id:t.order_id,transaction_id:e.razorpay_payment_id},"/api/subscriptions/process-order").then(function(e){t.datetime=e.datetime,e.success?t.show_success=!0:alert(e.message),t.processing_order=!1})},prefill:{name:t.student.name,email:"",contact:t.student.mobile_number},notes:{address:"BBFS"},theme:{color:"#F37254"},modal:{ondismiss:function(){alert("Payment has been cancelled. Kindly retry")}}};new Razorpay(e).open()}}]);