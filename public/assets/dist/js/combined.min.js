Directive.$inject=["$rootScope"];var app=angular.module("app",["ngFileUpload","jcs-autoValidate","uiCropper","ngSanitize"]);function Directive(e){return{require:"ngModel",link:function(t,e,a,o){a.id,ClassicEditor.create(document.querySelector("#editor_data")).then(e=>{(window.editor=e).setData(t.editor_data)})}}}angular.module("jcs-autoValidate").run(["defaultErrorMessageResolver",function(e){e.getErrorMessages().then(function(e){e.PatternMobile="Please fill a valid mobile number",e.PatternPin="Please fill a valid pin code",e.patternInt="Please fill a numeric value",e.patternFloat="Please fill a numeric/decimal value",e.patternDate="Please fill a valid date in DD-MM-YYYY format",e.PatternUsername="This field allows alphanumeric and . only between 4 to 20 chars"})}]),app.directive("convertToNumber",function(){return{require:"ngModel",link:function(e,t,a,o){o.$parsers.push(function(e){return null!=e?parseInt(e,10):null}),o.$formatters.push(function(e){return null!=e?""+e:null})}}}),app.directive("capitalize",function(){return{require:"ngModel",link:function(e,a,t,o){function s(e){var t=(e=null==e?"":e).toUpperCase();return t!==e&&(e=a[0].selectionStart,o.$setViewValue(t),o.$render(),a[0].selectionStart=e,a[0].selectionEnd=e),t}o.$parsers.push(s),s(e[t.ngModel])}}}),app.directive("tablePaginate",["$compile",function(e){return{restrict:"EA",template:'<div class="row">        <div class="col-md-6" >        <div class="total-count" ng-if="filter.max_page > 0">Showing <span>{{filter.max_per_page*(filter.page_no-1) + 1}} - {{filter.max_per_page*filter.page_no < total ? filter.max_per_page*filter.page_no : total}}</span> of <span>{{total}}</span></div>        </div>        <div class="col-md-6" style="text-align: right;">          <button class="btn fl-btn" ng-click="filter.show = (filter.show ? false:true )" ng-class=" filter.show ? \'open\' :\'\' "><i class="icons icon-grid"></i> Filter</button>          <ul class="pagination" ng-if="filter.max_page > 1">            <li class="page-item">              <a class="page-link" href="javascript:;" ng-click="setPage(1)"> << </a>            </li>            <li class="page-item">              <a class="page-link" href="javascript:;" ng-click="setPage(filter.page_no - 1)"> < </a>            </li>            <li class="page-item" ng-repeat="page in pages">              <a class="page-link" href="javascript:;" ng-click="setPage(page)" ng-class="page == filter.page_no ? \'active\' : \'\' ">{{page}}</a>            </li>            <li class="page-item">              <a class="page-link" href="javascript:;" ng-click="setPage(filter.page_no + 1)"> > </a>            </li>            <li class="page-item">              <a class="page-link" href="javascript:;" ng-click="setPage(filter.max_page)"> >> </a>            </li>          </ul>      </div>      </div>',link:function(t,e,a){t.setPagination=function(){var e=[];1==t.filter.page_no?(e.push(1),e.push(2),2<t.filter.max_page&&e.push(3)):(t.filter.max_page==t.filter.page_no&&2<t.filter.max_page&&e.push(t.filter.page_no-2),e.push(t.filter.page_no-1),e.push(t.filter.page_no),t.filter.max_page!=t.filter.page_no&&e.push(t.filter.page_no+1)),t.pages=e},t.setPagination(),t.setPage=function(e){e<1||e>t.filter.max_page||e==t.page_number||(t.filter.page_no=e,t.setPagination(),t.getList())}}}}]),app.directive("thSort",["$compile",function(e){return{restrict:"EA",template:function(e,t){return'<span style="display:block; cursor:pointer" ng-click="setOrder(\''+t.columnId+"')\">"+t.columnName+" <span ng-if=\"filter.order_by == '"+t.columnId+'\'"><i class="icons icon-arrow-up" ng-if="filter.order_type == \'ASC\'"></i><i class="icons icon-arrow-down" ng-if="filter.order_type == \'DESC\'"></i></span></span>'},link:function(t,e,a){t.setOrder=function(e){e==t.filter.order_by?t.filter.order_type="ASC"==t.filter.order_type?"DESC":"ASC":(t.filter.order_by=e,t.filter.order_type="ASC"),t.filter.page_no=1,t.getList()}}}}]),app.directive("fileUpload",["$compile",function(e){return{restrict:"EA",template:function(e,t){return console.log(t),'<button type="button" class="button btn btn-primary" ngf-select="uploadFile($file, \''+t.fieldName+"', "+t.objectName+' )" ladda="uploading" ng-if="!formData.'+t.fieldName+'">Upload</button>           <a type="button" class="btn btn-primary" href="{{ formData.'+t.fieldName+'_url}}" ng-if="formData.'+t.fieldName+'" target="_blank">View</a>           <a type="button" class="btn btn-danger" ng-click="removeFile(\''+t.fieldName+"', "+t.objectName+')" ng-if="formData.'+t.fieldName+'">Remove</a>'},link:function(s,e,t){s.uploadFile=function(e,t,a){s.uploading=!0;var o=base_url+"/upload/file";s.upload.upload({url:o,data:{file:e}}).then(function(e){e.data.success?(a[t]=e.data.file,a[t+"_url"]=e.data.file_url):alert(e.data.message),s.uploading=!1},function(e){console.log("Error status: "+e.status),s.uploading=!1},function(e){s.uploading_percentage=parseInt(100*e.loaded/e.total)+"%"})},s.removeFile=function(e,t){t[e]="",t[e+"_url"]=""}}}}]),app.directive("eBarChart",["$compile",function(e){return{restrict:"EA",template:'<div class="chartarea" style="width:550px; height:300px"></div>',link:function(e,t,a){for(var t=t[0].querySelectorAll(".chartarea"),o=(console.log(a),a.dataid),s=e[a.datagraph],n=(angular.forEach(t,function(e,t){angular.element(e).attr("id",o)}),[]),i=[],c=0;c<s.length;c++)n.push(s[c].label),i.push(s[c].value);options={grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:n},yAxis:{type:"value"},tooltip:{trigger:"item",formatter:"{b} : {c}"},series:[{data:i,type:"bar",label:{normal:{show:!0,position:"top",distance:15,align:"left",verticalAlign:"middle",rotate:90,formatter:function(e){var t=e.data;return t<1e3?e.data:t<1e5?(e.data/1e3).toFixed(1)+" K":(e.data/1e5).toFixed(1)+" L"},fontSize:12,rich:{name:{textBorderColor:"#fff"}}}}}]},setTimeout(function(){echarts.init(document.getElementById(o)).setOption(options)},2e3)}}}]),app.directive("eLineChart",["$compile",function(e){return{restrict:"EA",template:'<div class="chartarea" style="width:100%; height:250px;"></div>',link:function(e,t,a){for(var t=t[0].querySelectorAll(".chartarea"),o=a.dataid,s=e[a.datagraph],e=(angular.forEach(t,function(e,t){angular.element(e).attr("id",o)}),s.labels),n=[],i=s.legends,c=0;c<s.values.length;c++)n.push({name:i[c],data:s.values[c],type:"line"});console.log(n),options={darkMode:"decal",grid:{top:"3%",left:"3%",right:"4%",bottom:"15%",containLabel:!0},legend:{data:i,bottom:-200},xAxis:{type:"category",data:e},yAxis:{type:"value"},tooltip:{trigger:"axis"},series:n},setTimeout(function(){echarts.init(document.getElementById(o)).setOption(options)},2e3)}}}]),app.filter("INR",function(){return function(e){var t,a,o;if(!isNaN(e))return t=(currency_format,""),a=(e=e.toString().split("."))[0].substring(e[0].length-3),""!=(o=e[0].substring(0,e[0].length-3))&&(a=","+a),o=o.replace(/\B(?=(\d{2})+(?!\d))/g,",")+a,1<e.length&&(o+="."+e[1]),t+o}}),app.directive("ckeditor",Directive),app.run(["$rootScope","DBService",function(a,o){a.studentDetail=function(e){o.getCall("/api/student/get-info/"+e).then(function(e){e.success?(a.student=e.student,$("#student_personal_detail").modal("show")):alert(e.message)})},a.trimText=function(e,t){return e.length>t?e.substr(0,t)+"...":e},a.showInfo=function(e,t){a.modal_info=e,a.modal_type=t,$("#infoModal").modal("show")},a.viewPayment=function(e){o.getCall("/api/student/payment/view-payment/"+e).then(function(e){a.payment=e.payment,$("#viewPaymentModal").modal("show")})},a.sendPaymentEmail=function(e){o.getCall("/api/student/payment/view-payment/"+e).then(function(e){a.payment=e.payment,$("#viewPaymentModal").modal("show")})},a.sendPaymentEmail=function(t){bootbox.confirm("Are you sure to mail payment receipt?",e=>{e&&(a.processing_pay_mail=!0,o.postCall({payment_id:t},"/api/student/payment-email").then(function(e){bootbox.alert(e.message),a.processing_pay_mail=!1}))})}}]),app.service("DBService",["$http","$rootScope",function(a,e){this.getCall=function(e){return a({method:"GET",url:base_url+e,headers:{apiToken:api_key,clientId:client_id}}).then(function(e){if(200==e.status)return e.data})},this.postCall=function(e,t){return a({method:"POST",url:base_url+t,data:e,headers:{apiToken:api_key,clientId:client_id}}).then(function(e){if(200==e.status)return e.data})}}]),app.controller("Students_profile_controller",["$scope","$http","DBService","Upload",function(o,e,s,a){o.sport_id=0,o.student={},o.state_city_center={},o.loading=!0,o.processing=!1,o.switchContent="payments",o.performance_category_id=0,o.attendance={weeks:[]},o.p_categories=[],o.month="",o.year="",o.myImage="",o.myCroppedImage="",o.docType=[],o.inactiveReasons=[],o.payType=[],o.payTypeCat=[],o.payModes=[],o.item={category_id:"",type_id:"",amount:"",tax:"",total:""},o.guardians={name:"",mobile:"",email:"",type_id:""},o.add_student={guardians:[]},o.student_details=function(e){o.student_id=e,o.getStateCityCenter("st-edit"),s.postCall({student_id:e},"/api/student/details").then(function(e){o.student=e.student,e.student.payment_access||(o.switchContent="subscriptions"),o.loading=!1}),o.getAttendance(),o.getPerformanceReports(),o.getPerformanceGraph()},o.editStudent=function(e){o.getStateCityCenter("st-edit"),0<e?s.postCall({student_id:e},"/api/student/edit-student").then(function(e){e.success?(o.add_student=e.student,o.add_student.edit=!0,o.selectCity(e.student.state_id),o.loading=!1):bootbox.alert(e.message)}):o.loading=!1},o.selectCity=function(e){s.getCall("/api/cities/"+e).then(function(e){e.success&&(o.cities=e.cities)})},o.getStateCityCenter=function(e){s.postCall({Tag:e},"/api/get-state-city-center-data").then(function(e){e.success&&(o.state_city_center=e)})},o.addGuardian=function(){o.add_student.guardians.push(JSON.parse(JSON.stringify(o.guardians)))},o.removeGuardian=function(e){o.add_student.guardians.splice(e,1)},o.add_data=function(){o.processing=!0,s.postCall(o.add_student,"/api/student/add-student").then(function(e){e.success?(o.message=e.message,o.add_student.id?location.href=base_url+"/students/student_details/"+e.studentId:($("#addStudentModal").modal("show"),o.location=base_url+"/students/student_details/"+e.studentId)):bootbox.alert(e.status.message),o.processing=!1})},o.reloadRoute=function(){location.reload()},o.changeProfilePicture=function(e){s.postCall({stduent_id:o.student.id,picture:e},"/api/student/change-profile-pic").then(function(e){e.success,bootbox.alert(e.message)})},o.saveDocuments=function(){o.processing_req=!0,o.document.student_id=o.student_id,s.postCall(o.document,"/api/student/save-documents").then(function(e){e.success?(bootbox.alert(e.message),o.student_details(o.student_id),$("#documents_modal").modal("hide"),o.document={}):bootbox.alert(e.message),o.processing_req=!1})},o.uploadDocument=function(e){var t=base_url+"/uploads/file";a.upload({url:t,data:{file:e}}).then(function(e){e.data.success?(o.document.document_url=e.data.path,o.document.prev_url=e.data.url):bootbox.alert(e.data.message),o.uploading_file=!1},function(e){o.uploading_file=!1},function(e){o.uploading_percentage=parseInt(100*e.loaded/e.total)+"%"})},o.addInFilterArray=function(e,t){var a=o.filter[e].indexOf(t);a<0?o.filter[e].push(t):o.filter[e].splice(a,1)},o.applyFilters=function(){o.page_no=1,o.fetchStudentData()},o.hide_data_modal=function(e){o.editModal=!1,$("#"+e).modal("hide")},o.groupShift=function(){(shift_data=o.groupShifting).student_id=o.student_id,o.processing_req=!0,s.postCall(shift_data,"/api/student/group-change").then(function(e){e.success?(bootbox.alert(e.message),o.student_details(o.student.id),o.hide_data_modal("group_shift_modal")):bootbox.alert(e.message),o.processing_req=!1})},o.switchContentFun=function(e){o.switchContent=e};angular.element(document.querySelector("#fileInput")).on("change",function(e){var e=e.currentTarget.files[0],t=new FileReader;t.onload=function(t){o.$apply(function(e){e.myImage=t.target.result})},t.readAsDataURL(e)}),o.discard=function(){o.myImage="",o.myCroppedImage="",$("#playerPhoto").modal("hide")},o.selectCroppedChangePic=function(){o.uploading=!0,name="photo";var e=base_url+"/upload/photo";a.upload({url:e,data:{photo:a.dataUrltoBlob(o.myCroppedImage,name),resize:1,crop:1,width:400,height:400}}).then(function(e){e.data.success?(o.myImage="",o.myCroppedImage="",o.changeProfilePicture(e.data.path),o.student.pic=e.data.url,$("#ChangeplayerPhoto").modal("hide")):bootbox.alert(data.message),o.uploading=!1},function(e){0<e.status&&(o.errorMsg=e.status+": "+e.data),o.uploading=!1},function(e){o.progress=parseInt(100*e.loaded/e.total)})},o.addInactive=function(){o.inactive={},o.getInactiveReason(),$("#inactive_modal").modal("show")},o.editInactive=function(e){o.editModal=!0,o.inactive=e,o.getInactiveReason(),$("#inactive_modal").modal("show")},o.saveInactive=function(e){o.processing_req=!0,e.student_id=o.student.id,s.postCall(e,"/api/student/save-inactive").then(function(e){e.success?(bootbox.alert(e.message),o.student_details(o.student.id),$("#inactive_modal").modal("hide")):bootbox.alert(e.message),o.processing_req=!1})},o.deleteInactive=function(t){bootbox.confirm("Are you sure?",e=>{e&&s.postCall({id:t},"/api/student/delete-inactive").then(function(e){e.success?(bootbox.alert(e.message),o.student_details(o.student.id)):bootbox.alert(e.message)})})},o.addInjury=function(){o.editModal=!1,o.injury={},$("#injury_modal").modal("show")},o.editInjury=function(e){o.editModal=!0,o.injury=e,$("#injury_modal").modal("show")},o.saveInjury=function(e){e.student_id=o.student.id,o.processing_req=!0,s.postCall(e,"/api/student/save-injury").then(function(e){e.success?(bootbox.alert(e.message),o.student_details(o.student.id),$("#injury_modal").modal("hide")):bootbox.alert(e.message),o.processing_req=!1})},o.deleteInjury=function(t){bootbox.confirm("Are you sure?",e=>{e&&s.postCall({id:t},"/api/student/delete-injury").then(function(e){e.success?(bootbox.alert(e.message),o.student_details(o.student.id)):bootbox.alert(e.message)})})},o.addGroupShift=function(){o.editModal=!1,o.groupShifting={},$("#group_shift_modal").modal("show")},o.deleteGroupShift=function(t){bootbox.confirm("Are you sure?",e=>{e&&s.postCall({id:t},"/api/student/delete-group-shift").then(function(e){e.success?(bootbox.alert(e.message),o.student_details(o.student.id)):bootbox.alert(e.message)})})},o.addDocument=function(){o.document={},o.editModal=!1,o.getDocumentsType(),$("#documents_modal").modal("show")},o.getInactiveReason=function(){s.postCall({},"/api/student/get-inactive-reason").then(function(e){e.success&&(o.inactiveReasons=e.inactiveReasons)})},o.getDocumentsType=function(){s.postCall({},"/api/student/get-document-type").then(function(e){e.success&&(o.docType=e.docType)})},o.getPaymentType=function(){s.getCall("/api/student/payment/get-type/"+o.sport_id).then(function(e){e.success&&(o.payType=e.payType,o.payTypeCat=e.payTypeCat,o.payModes=e.payModes)})},o.addPayment=function(e){o.getPaymentType(),s.postCall({student_id:o.student.id,type:e,payment_id:0},"/api/student/payment/init").then(function(e){e.success?(o.payment=e.payment,$("#paymentModal").modal("show"),o.getCoupon(o.student_id)):bootbox.alert(e.message)})},o.addPaymentItem=function(){o.payment.items.push(JSON.parse(JSON.stringify(o.item))),o.calculateTotal()},o.removePaymentItem=function(e){o.payment.items.splice(e,1),o.calculateTotal()},o.getAmount=function(){o.getting_amount=!0,o.item.type_id&&s.postCall({group_id:o.student.group_id,category_id:o.item.category_id,type_id:o.item.type_id},"/api/student/payment/get-amount").then(function(e){o.item.category=e.category_name,o.item.type=e.type_name,o.item.months=e.months,o.item.amount=e.price.price,o.item.discount=0,o.item.taxable_amount=o.item.amount-o.item.discount,o.item.tax_perc=e.price.tax_perc,o.item.tax=Math.round(e.price.price*e.price.tax_perc/100),o.item.total_amount=o.item.amount+o.item.tax,o.getting_amount=!1})},o.applyCoupon=function(){s.postCall({coupon_id:o.item.coupon_id,items:o.payment.items},"/api/student/payment/apply-coupon").then(function(e){o.payment.items=e.items,o.calculateTotal()})},o.applyTax=function(e){e.amount&&(e.taxable_amount=parseFloat(e.amount)-parseFloat(e.discount),e.tax=Math.round(e.taxable_amount*parseFloat(e.tax_perc)/100),e.total_amount=e.taxable_amount+e.tax,o.calculateTotal())},o.calculateTotal=function(){for(var e=0,t=0,a=0;a<o.payment.items.length;a++)o.payment.items[a].taxable_amount&&(e+=parseFloat(o.payment.items[a].taxable_amount)),o.payment.items[a].tax&&(t+=parseFloat(o.payment.items[a].tax));o.payment.amount=e,o.payment.tax=t,o.payment.total_amount=e+t},o.savePayment=function(){o.processing=!0,o.payment.student_id=o.student.id,s.postCall(o.payment,"/api/student/payment/save-payment").then(function(e){e.success?(bootbox.alert(e.message),o.student_details(o.student.id),o.processing=!1,$("#paymentModal").modal("hide")):(bootbox.alert(e.message),o.processing=!1)})},o.editPayment=function(e){o.getPaymentType(),s.postCall({payment_id:e},"/api/student/payment/edit-payment").then(function(e){e.success?(o.payment=e.payment,o.payment.edit=!0,$("#paymentModal").modal("show"),o.getCoupon(o.student_id)):bootbox.alert(e.message)})},o.getCoupon=function(e){s.postCall({student_id:e},"/api/student/payment/get-coupons").then(function(e){e.success&&(o.coupons=e.coupons)})},o.deleteDocuement=function(t,a){bootbox.confirm("Are you sure?",function(e){e&&s.postCall({id:t},"/api/student/delete-document").then(function(e){e.success?(bootbox.alert(e.message),o.student.documents.splice(a,1)):bootbox.alert(e.message)})})},o.viewSubscription=function(e){o.open_subscription={},s.getCall("/api/student/subscription/view/"+e).then(function(e){e.success?(o.open_subscription=e.subscription,$("#subModal").modal("show")):bootbox.alert(e.message)})},o.editSubscription=function(e){o.open_subscription={},s.getCall("/api/student/subscription/view/"+e.id).then(function(e){e.success?(o.open_subscription=e.subscription,$("#pauseAddModal").modal("show")):bootbox.alert(e.message)})},o.addPause=function(){o.adding_pause=!0,o.pauseData.subscription_id=o.open_subscription.id,o.pauseData.student_id=o.student.id,s.postCall(o.pauseData,"/api/student/subscription/save").then(function(e){e.success&&(o.student_details(o.student.id),$("#pauseAddModal").modal("hide")),bootbox.alert(e.message),o.adding_pause=!1})},o.approvePause=function(e,t){o.open_pause=e,o.open_pause.status=t,$("#pauseApprovalModal").modal("show")},o.processPauseRequest=function(){o.processing_req=!0,s.postCall(o.open_pause,"/api/student/subscription/approve").then(function(e){e.success&&(o.student_details(o.student.id),$("#pauseApprovalModal").modal("hide")),bootbox.alert(e.message),o.processing_req=!1})},o.deletePauseRequest=function(t){bootbox.confirm("Are you sure?",e=>{e&&s.postCall({pause_id:t},"/api/student/subscription/delete").then(function(e){e.success&&(o.student_details(o.student.id),$("#subModal").modal("hide")),bootbox.alert(e.message)})})},o.sendWelcomeEmail=function(){bootbox.confirm("Are you sure to send welcome email for "+o.student.name+"?",e=>{e&&(o.processing_email=!0,s.postCall({student_id:o.student_id},"/api/student/send-welcome-email").then(function(e){bootbox.alert(e.message),o.processing_email=!1}))})},o.getAttendance=function(){s.postCall({month:o.month,year:o.year},"/api/student/attendance/"+o.student_id).then(function(e){o.attendance.month_name=e.month_name,o.attendance.year=e.year,o.attendance.weeks=e.weeks,o.month=e.month,o.year=e.year})},o.prev_month=function(){o.month--,0==o.month&&(o.month=12,o.year--),o.getAttendance()},o.next_month=function(){o.month++,13==o.month&&(o.month=1,o.year++),o.getAttendance()},o.getPerformanceReports=function(){s.postCall({},"/api/student/reports/"+o.student_id).then(function(e){o.reports=e.reports})},o.getPerformanceGraph=function(){o.p_data={legends:[],labels:[],values:[]},o.loading_graph=!0,s.postCall({category_id:o.performance_category_id},"/api/student/performance-graph/"+o.student_id).then(function(e){o.p_data=e.p_data,o.p_categories=e.categories,o.loading_graph=!1})}}]),app.controller("Students_controller",["$scope","$http","DBService","Upload",function(t,e,a,o){t.loading=!1,t.dataset=[],t.params=[],t.filter={page_no:1,max_per_page:20,max_page:1,order_by:"",order_type:"ASC",export:!1,show:!1,pending_renewal:!1,status:[0]},t.total=0,t.myImage="",t.myCroppedImage="",t.init=function(){t.getList()},t.getList=function(){t.loading=!0,a.postCall(t.filter,"/api/student/get-list").then(function(e){e.success?t.filter.export?window.open(e.excel_link,"_blank"):(t.dataset=e.students,t.total=e.total,t.filter.max_page=Math.ceil(t.total/t.filter.max_per_page)):bootbox.alert(e.message),t.loading=!1,t.filter.searching=!1,t.filter.clearing=!1,t.filter.exporting=!1,t.filter.export=!1,t.setPagination()})},t.getParams=function(){t.getStateCityCenter("st-profile")},t.getStateCityCenter=function(e){a.postCall({Tag:e},"/api/get-state-city-center-data").then(function(e){e.success&&(t.state_city_center=e)})},t.getParams(),t.searchList=function(){t.filter.page_no=1,t.filter.searching=!1,t.getList()},t.clear=function(){t.filter={page_no:1,max_per_page:20,max_page:1,clearing:!0},t.getList()},t.exportList=function(){t.exporting=!0,t.filter.export=!0,t.getList()}}]),app.controller("Stu_Attendance_Controller",["$scope","$http","DBService","Upload",function(s,e,t,a){s.cityCenter={},s.filterData={show:!0},s.students=[],s.dates=[],s.loading=!0,s.processing=!1,s.getCityCenter=function(e){t.postCall({Tag:e},"/api/get-state-city-center-data").then(function(e){s.cityCenter=e,s.loading=!1})},s.getStudents=function(){s.processing=!0,t.postCall({group_id:s.filterData.group_id,month:s.filterData.month,year:s.filterData.year},"/api/student/attendance").then(function(e){s.dates=e.dates,s.students=e.students,s.processing=!1})},s.addAttendance=function(e){for(var t=0;t<s.students.length;t++){var a=s.students[t].present.indexOf(e),o=s.students[t].absent.indexOf(e);-1==a&&s.students[t].present.push(e),-1<o&&s.students[t].absent.splice(o,1)}},s.switchAttendance=function(e,t){var a=e.present.indexOf(t),o=e.absent.indexOf(t);-1==a&&-1==o?e.present.push(t):-1<a?(e.present.splice(a,1),e.absent.push(t)):-1<o&&e.absent.splice(a,1)},s.saveAttendance=function(){s.saveprocessing=!0,t.postCall({students:s.students,dates:s.dates,group_id:s.filterData.group_id},"/api/student/attendance/save-attendance").then(function(e){e.success?(s.saveprocessing=!1,s.getStudents(),bootbox.alert(e.message)):(bootbox.alert(e.message),s.saveprocessing=!1)})}}]),app.controller("Stu_Performance_Controller",["$scope","$http","DBService","Upload",function(a,e,o,t){a.cityCenter={},a.filterData={show:!0,session_id:1},a.performanceParm={},a.students=[],a.studentRecord={},a.sessionList=[],a.open_category_id=0,a.processing=!1,a.loading=!0,a.getCityCenter=function(e){o.postCall({Tag:e},"/api/get-state-city-center-data").then(function(e){a.cityCenter=e,a.loading=!1})},a.getStudents=function(){a.processing_req=!0,o.postCall({group_id:a.filterData.group_id,session_id:a.filterData.session_id},"/api/student/performance/students").then(function(e){a.students=e.students,0<e.students.length&&(a.studentRecord.student_id=e.students[0].id,a.studentRecord.student_name=e.students[0].name,a.processing_req=!1,a.getStudentRecord()),a.processing_req=!1})},a.switchStudent=function(e){a.studentRecord.student_id=e.id,a.studentRecord.student_name=e.name,a.getStudentRecord()},a.getStudentRecord=function(){o.postCall({student_id:a.studentRecord.student_id,session_id:a.filterData.session_id},"/api/student/performance/student-record").then(function(e){a.studentRecord.skill_categories=e.skill_categories,a.studentRecord.mailed=e.mailed,a.studentRecord.uuid=e.uuid,a.open_category_id=e.skill_categories[0].id})},a.openHeader=function(e){a.open_category_id=e.id},a.ratingMarked=function(e,t){e.value=t},a.submitRecord=function(e){a.processing=!0,o.postCall({studentRecord:a.studentRecord,session_id:a.filterData.session_id,type:e},"/api/student/performance/save-score").then(function(e){if(e.success){bootbox.alert(e.message),a.studentRecord.uuid=e.uuid;for(var t=0;t<a.students.length;t++)a.students[t].id==a.studentRecord.student_id&&(a.students[t].uuid=e.uuid);a.processing=!1}else bootbox.alert(e.message),a.processing=!1})},a.getSessionList=function(){o.getCall("/api/student/performance/get-session-list").then(function(e){e.success&&(a.sessionList=e.sessionList,a.loading=!1)})},a.deleteSession=function(t){bootbox.confirm("Are you sure?",e=>{e&&o.getCall("/api/student/performance/delete-session/"+t).then(function(e){e.success?(bootbox.alert(e.message),a.getSessionList()):bootbox.alert(e.message)})})},a.saveSession=function(){a.processing=!0,o.postCall(a.session,"/api/student/performance/add-session").then(function(e){e.success?(bootbox.alert(e.message),a.getSessionList(),a.processing=!1,$("#session_modal").modal("hide")):(bootbox.alert(e.message),a.processing=!1)})},a.addSession=function(){a.session={},$("#session_modal").modal("show")},a.editSession=function(e){a.session=e,$("#session_modal").modal("show")},a.hide_data_modal=function(e){$("#"+e).modal("hide")},a.sendEmail=function(){bootbox.confirm("Are you sure to send performance pdf for "+a.studentRecord.student_name+"?",e=>{e&&(a.processing_mail=!0,o.postCall({uuid:a.studentRecord.uuid},"/api/student/performance/mail-pdf").then(function(e){if(e.success){bootbox.alert(e.message),a.studentRecord.mailed=1;for(var t=0;t<a.students.length;t++)a.students[t].id==a.studentRecord.student_id&&(a.students[t].mailed=1)}else bootbox.alert(e.message);a.processing_mail=!1}))})}}]),app.controller("DropDownMasterController",["$scope","$http","DBService",function(o,e,s){o.loading=!0,o.processing=!1,o.formData={},o.attrData={},o.init=function(){s.getCall("/api/group-type/init").then(function(e){o.group_types=e.group_types,o.loading=!1})},o.addGroupType=function(){o.formData={},$("#group-type-modal").modal("show")},o.submit=function(){o.processing=!0,s.postCall(o.formData,"/api/group-type/save").then(function(e){e.success?(bootbox.alert(e.message),o.init(),$("#group-type-modal").modal("hide")):bootbox.alert(e.message),o.processing=!1})},o.edit=function(e){o.formData={},o.formData=JSON.parse(JSON.stringify(e)),$("#group-type-modal").modal("show")},o.delete=function(t,a){bootbox.confirm("Are you sure?",e=>{e&&(o.processing=!0,s.getCall("/api/group-type/delete/"+t).then(function(e){e.success?(bootbox.alert(e.message),o.group_types.splice(a,1)):bootbox.alert(e.message),o.processing=!1}))})}}]),app.controller("CenterController",["$scope","$http","$timeout","DBService","Upload",function(o,e,t,s,n){o.center={},o.centers={},o.cities=[],o.contact_person={},o.operation_timing={day:""},o.members=[],o.timing={update:!1,day:0},o.loading=!0,o.year={},o.months={},o.quaters={},o.group={},o.cetegories={},o.edit_group_id=null,o.update=!0,o.city_id=0,o.processing=!1,o.imageProcessing=!1,o.path={},o.cityList=function(){s.getCall("/api/get-city-list").then(function(e){e.success&&(o.cities=e.data)})},o.centerList=function(){s.postCall({city_id:o.city_id},"/api/centers/list").then(function(e){e.success&&(o.centers=e.data)}),o.cityList()},o.addCenter=function(){$("#add_center_modal").modal("show")},o.createNewCenter=function(){o.processing=!0,s.postCall(o.center,"/api/centers/add").then(function(e){e.success?window.location=base_url+"/centers/edit/"+e.id:bootbox.alert(e.message),o.processing=!1})},o.init=function(e){o.loading=!0,s.postCall({center_id:e},"/api/centers/edit").then(function(e){e.success?(o.center=e.center,o.fetchCenterImages(),o.fetchCenterGroups(),o.params()):bootbox.alert(e.message),o.loading=!1})},o.params=function(){s.getCall("/api/centers/params").then(function(e){e.success&&(o.cities=e.cities,o.cordinators=e.cordinators,o.days=e.days,o.categories=e.categories,o.even_categories=e.even_categories)})},o.fetchCenterImages=function(){s.getCall("/api/centers/images/"+o.center.id).then(function(e){o.center.images=e.images})},o.fetchCenterGroups=function(){s.getCall("/api/centers/groups/"+o.center.id).then(function(e){o.center.groups=e.groups,o.fetchGroupTypes()})},o.fetchGroupTypes=function(){s.getCall("/api/centers/group-types").then(function(e){o.group_types=e.group_types})},o.onSubmit=function(){o.processing=!0,s.postCall(o.center,"/api/centers/update").then(function(e){bootbox.alert(e.message),o.processing=!1})},o.uploadCenterImage=function(e,t){var a;o.imageProcessing=!0,e&&(o.uploading=!0,a=base_url+"/api/upload/photo",n.upload({url:a,data:{photo:e,resize:1,crop:0,width:720,thumb:1}}).then(function(e){e.data.success?o.saveImage(e.data.url,e.data.url_thumb):alert(e.data.message),o.uploading=!1},function(e){console.log("Error status: "+e.status),o.uploading=!1},function(e){o.uploading_percentage=parseInt(100*e.loaded/e.total)+"%"})),o.imageProcessing=!1},o.saveImage=function(e,t){o.path.center_id=o.center.id,o.path.path_url=e,o.path.thumb_url=t,s.postCall(o.path,"/api/centers/save-image").then(function(e){e.success?(bootbox.alert(e.message),o.fetchCenterImages()):bootbox.alert(e.message)})},o.removeImage=function(t,a){bootbox.confirm("Are you sure?",e=>{e&&s.postCall(t,"/api/centers/remove-image").then(function(e){e.success?(bootbox.alert(e.message),o.center.images.splice(a,1)):bootbox.alert(e.message),t.processing=!1})})},o.loadTargets1=function(){o.loading_target=!0,s.postCall({year_id:o.year.year_id,center_id:o.center.id},"/api/center/loadTargets").then(function(e){e.year?o.year=e.year:o.year={year_id:o.year.year_id},e.quaters?o.quaters=e.quaters:o.quaters={},e.months?o.months=e.months:o.months={},o.loading_target=!1})},o.addContactPersonData1=function(){s.postCall({data:o.center},"/api/centers/add-contact-person").then(function(e){e.success&&$("#contact_modal").modal("hide")})},o.addPersonToList1=function(){o.contact_person.member_name&&o.center.contact_persons.push(JSON.parse(JSON.stringify(o.contact_person))),o.addContactPersonData(),o.contact_person={}},o.removePerson1=function(e){confirm("Are you sure")&&(o.center.contact_persons.splice(e,1),o.addContactPersonData())},o.addTimingInList=function(){o.timmingProcessing=!0,o.timing.center_id=o.center.id,s.postCall(o.timing,"/api/centers/addGroupTiming").then(function(e){e.success?(bootbox.alert(e.message),$("#training_day_modal").modal("hide"),o.fetchCenterGroups()):bootbox.alert(e.message),o.timmingProcessing=!1})},o.editTiming=function(e){e.update=!0,o.timing={},o.timing=JSON.parse(JSON.stringify(e)),$("#training_day_modal").modal("show")},o.cancelTimingEdit=function(){o.timing={update:!1,group_id:0,day:0}},o.removeTiming=function(e){$("#remove-timing").modal("show"),o.open_timing=e},o.submitRemoveTiming=function(){o.open_timing.processing=!0,s.postCall({timing:o.open_timing},"/api/centers/deleteTiming").then(function(e){e.success?(o.center.groups=e.center.groups,o.open_timing={},$("#remove-timing").modal("hide")):bootbox.alert(e.message),o.open_timing.processing=!1})},o.deleteCenter=function(t,a){bootbox.confirm("Are you sure?",e=>{e&&s.getCall("/api/centers/delete-center/"+t).then(function(e){e.success?(bootbox.alert(e.message),o.centers.splice(a,1)):bootbox.alert(e.message)})})},o.addGroup=function(){o.group={},$("#group_modal").modal("show")},o.updateGroup=function(e){s.getCall("/api/centers/edit-group/"+e).then(function(e){o.group=e.group}),$("#group_modal").modal("show")},o.onSubmit_group=function(){o.groupProcessing=!0,o.group.center_id=o.center.id,s.postCall(o.group,"/api/centers/add-group").then(function(e){e.success?($("#group_modal").modal("hide"),o.fetchCenterGroups()):bootbox.alert(e.message),o.groupProcessing=!1})},o.deleteGroup=function(e){s.postCall({id:e},"/api/groups/delete").then(function(e){e.success?(bootbox.alert(e.message),o.init(o.center.id)):bootbox.alert(e.message)})},o.addTrainingDay=function(e){o.timing={update:!1,group_id:e,day:0},$("#training_day_modal").modal("show")},o.viewCurriculum1=function(e){$("#viewCurriculum").modal("show"),o.group_events=[],s.postCall({group_id:e},"/api/centers/group/schedule").then(function(e){e.success&&(o.group_events=e.events),o.processing=!1})},o.addContactPerson1=function(){$("#contact_modal").modal("show")},o.hideModal1=function(e){$("#"+e).modal("hide")},o.addCoach=function(e,t){o.group_coach={},o.group_id=t,o.group_coach=e,s.getCall("/api/centers/coach").then(function(e){e.success&&(o.coachs=e.coachs)}),$("#add_coach_modal").modal("show")},o.submitCoach=function(){o.processingCoach=!0,s.postCall({coach:o.coach_id,group_id:o.group_id},"/api/centers/save-coach").then(function(e){e.success&&(o.fetchCenterGroups(),bootbox.alert(e.message),$("#add_coach_modal").modal("hide")),o.processingCoach=!1})},o.removeCoach=function(t,a){bootbox.confirm("Are you sure?",e=>{e&&s.getCall("/api/centers/remove-coach/"+t).then(function(e){e.success&&(bootbox.alert(e.message),o.group_coach.splice(a,1))})})}}]),app.controller("CenterReportController",["$scope","$timeout","$http","$timeout","DBService","Upload",function(s,o,e,o,t,a){s.searchData={},s.records=[],s.loading=!0,s.center_ids=[],s.data_points=[],s.prr_type=1,s.graph={type:1,start_date:"",end_date:""},s.centerDetails=function(e){s.open_center=[],s.open_center=e,$("#centerDetails").modal("show"),s.center_loading=!0,t.postCall(e,"/api/center/getCenterInfo").then(function(e){e.success&&(s.open_center.groups=e.groups),s.center_loading=!1})},s.selected_centers=function(e,t){"center"==e&&(-1==s.center_ids.indexOf(t)?s.center_ids.push(t):s.center_ids.splice(t,1))},s.getRevenueReports=function(){s.searchData.api_key=api_key,s.center_ids=[],t.postCall(s.searchData,"/api/reports/revenueReport").then(function(e){if(e.success){s.records=e.records,s.combined_data=e.combined_data,s.revenue_month=e.revenue_month,s.annual_period=e.annual_period;for(var t=0;t<s.records.length;t++)for(var a=0;a<s.records[t].centers.length;a++)s.center_ids.push(s.records[t].centers[a].id);o(s.getGraphData(),1e3)}s.loading=!1})},s.getCenterInfo=function(e,t){console.log(e,t)},s.getGraphDataType=function(e){s.graph.start_date="",s.graph.end_date="",s.graph.type=e,s.getGraphData()},s.getGraphDataFilter=function(){""==s.graph.start_date?alert("Please select start date"):""==s.graph.end_date?alert("Please select end date"):(s.graph.type=4,s.getGraphData())},s.getGraphData=function(){0==s.center_ids.length?alert("Please select at least one center"):(s.data_points=[],t.postCall({center_ids:s.center_ids,graph:s.graph},"/api/reports/center/revenue").then(function(e){s.data_points=e.data_points}))},s.selectAll=function(){s.center_ids=[];for(var e=0;e<s.records.length;e++)for(var t=0;t<s.records[e].centers.length;t++)s.center_ids.push(s.records[e].centers[t].id)},s.unSelectAll=function(){s.center_ids=[]},s.selectAllCity=function(e){for(var t=0;t<s.records.length;t++)if(s.records[t].id==e)for(var a=0;a<s.records[t].centers.length;a++)-1==s.center_ids.indexOf(s.records[t].centers[a].id)&&s.center_ids.push(s.records[t].centers[a].id)},s.unSelectAllCity=function(e){for(var t=0;t<s.records.length;t++)if(s.records[t].id==e)for(var a=0;a<s.records[t].centers.length;a++){var o=s.center_ids.indexOf(s.records[t].centers[a].id);-1<o&&s.center_ids.splice(o,1)}},s.getPRRReports=function(){s.loading=!0,s.searchData.prr_type=s.prr_type,t.postCall(s.searchData,"/api/center/PRRReport").then(function(e){e.success&&(s.records=e.records,s.total_records=e.total),s.loading=!1})},s.getPricePackageReports=function(){t.postCall(s.searchData,"/api/center/getPricePackageReports").then(function(e){e.success&&(s.records=e.records),s.loading=!1})}}]),app.controller("smsTempCtrl",["$scope","$http","$timeout","DBService",function(o,e,t,s){o.formData={type:1},o.init=function(){s.getCall("/api/communications/sms-template/init").then(function(e){o.templates=e.templates})},o.add=function(){o.formData={type:1},$("#add-template").modal("show")},o.edit=function(e){o.formData=JSON.parse(JSON.stringify(e)),$("#add-template").modal("show")},o.onSubmit=function(){o.processing=!0,s.postCall(o.formData,"/api/communications/sms-template/store").then(function(e){if(e.success){if(o.formData.id)for(var t=o.templates.length-1;0<=t;t--)o.templates[t].id==e.template.id&&(o.templates[t]=e.template);else o.templates.push(e.template);o.formData={},o.addForm.$setPristine(),$("#add-template").modal("hide")}bootbox.alert(e.message),o.processing=!1})},o.delete=function(t,a){bootbox.confirm("Are you sure?",e=>{e&&s.getCall("/api/communications/sms-template/delete/"+t.id).then(function(e){e.success?(bootbox.alert(e.message),o.templates.splice(a,1)):bootbox.alert(e.message)})})}}]),app.controller("communicationCtrl",["$scope","$rootScope","DBService",function(o,e,t){o.max=50,o.pn=1,o.total_pn=0,o.count=0,o.checkAll=!1,o.show_list=!0,o.show_removed_list=!0,o.send_type_check=1,o.removed_students=[],o.msgData={demo_check:!1},o.filter={only_active:1,cities:[],centers:[],groups:[],status:[],categories:[],batch_types:[]},o.check_all=function(e){if(1==e){if(o.check_all_city){o.filter.cities=[];for(var t=o.cities.length-1;0<=t;t--)o.filter.cities.push(o.cities[t].value)}else o.filter.cities=[];o.showFilterCenters()}if(2==e){if(o.check_all_center){o.filter.centers=[];for(t=o.filter_centers.length-1;0<=t;t--)o.filter.centers.push(o.filter_centers[t].value)}else o.filter.centers=[];o.showFilterGroups()}if(3==e)if(o.check_all_groups){o.filter.groups=[];for(t=o.filter_groups.length-1;0<=t;t--)o.filter.groups.push(o.filter_groups[t].value)}else o.filter.groups=[];o.getStudents(1)},o.init=function(){o.getStateCityCenter()},o.getStateCityCenter=function(){t.postCall({Tag:"comm_user"},"/api/get-locations").then(function(e){e.success&&(o.cities=e.city,o.centers=e.center,o.groups=e.group)})},o.activeCenter=function(e){o.filter.only_active=e,o.init()},o.addFilter=function(e,t){var a=o.filter[e].indexOf(t);-1==a?o.filter[e].push(t):o.filter[e].splice(a,1),"cities"==e&&o.showFilterCenters(),"centers"==e&&o.showFilterGroups(),o.getStudents(1)},o.showFilterCenters=function(){o.filter_centers=[];for(var e,t=0;t<o.centers.length;t++)-1!=o.filter.cities.indexOf(o.centers[t].city_id)?o.filter_centers.push(o.centers[t]):-1!=(e=o.filter.centers.indexOf(o.centers[t].id))&&o.filter.centers.splice(e,1)},o.showFilterGroups=function(){o.filter_groups=[];for(var e,t=0;t<o.groups.length;t++)-1!=o.filter.centers.indexOf(o.groups[t].center_id)?o.filter_groups.push(o.groups[t]):-1!=(e=o.filter.groups.indexOf(o.groups[t].id))&&o.filter.groups.splice(e,1)},o.getStudents=function(e){o.filter.pn=e,o.pn=e,o.filter.removed_students=o.removed_students,o.filter.max=o.max,t.postCall(o.filter,"/api/communications/send-message/getStudents").then(function(e){e.success&&(o.students=e.students,o.student_ids=e.student_ids,0<e.students.length&&(o.checkAll=!0)),o.loading=!1,o.count=e.count,o.total_pn=e.total_pn})},o.nextPage=function(){(o.pn+1)*o.max<=o.count+o.max&&o.getStudents(o.pn+1)},o.prevPage=function(){0<o.pn-1&&o.getStudents(o.pn-1)},o.sortBy=function(e){o.filter.sort_by==e?"ASC"==o.filter.sorting?o.filter.sorting="DESC":""==o.filter.sorting?o.filter.sorting="ASC":o.filter.sorting="":(o.filter.sort_by=e,o.filter.sorting="ASC"),o.sort_by=o.filter.sort_by,o.sorting=o.filter.sorting,o.getStudents(1)},o.sendMessage=function(){o.msgData={},$("#messageForm").modal("show")},o.postMessage=function(){o.processing=!0,o.msgData.student_ids=o.student_ids,o.msgData.removed_students=o.removed_students,t.postCall(o.msgData,"/api/communications/send-message/postMessage").then(function(e){e.success&&!e.demo_check&&(o.filter={cities:[],centers:[],groups:[],status:[]},o.msgData={},o.removed_students=[],o.students=[],o.pn=1,o.total_pn=0,o.count=0,$("#messageForm").modal("hide")),o.processing=!1,alert(e.message)})},o.removeStudent=function(e,t){o.removed_students.push(e),o.students.splice(t,1),o.count--},o.addStudentToList=function(e,t){o.students.push(e),o.removed_students.splice(t,1),o.count++},o.showRemovedStudents=function(){$("#studentList").modal("show")}}]),app.controller("sendMessageCtrl",["$scope","$rootScope","DBService",function(t,e,a){t.variables=[],t.init=function(){a.postCall({api_key:api_key,only_active:t.filter.only_active},"/api/communications/send-message/init").then(function(e){e.success&&(t.sms_templates=e.sms_templates,t.email_templates=e.email_templates)})},t.init(),t.templateChange=function(){a.postCall(t.msgData,"/api/communications/send-message/get-content").then(function(e){if(e.success){for(t.msgData.original_content=e.content,t.msgData.content=e.content,variables=[],message_split=e.content.split("{#var#}"),repeat_no=message_split.length-1,variables=[],i=0;i<repeat_no;i++)variables.push({content:""});t.variables=variables,t.setContent()}})},t.setContent=function(){$("#content_msg").html(t.msgData.content)},t.modifyContent=function(){for(message_split=t.msgData.original_content.split("{#var#}"),final_message=message_split[0],index=1;index<message_split.length;index++)final_message=(final_message+=t.variables[index-1].content?t.variables[index-1].content:"{#var#}")+message_split[index];t.msgData.content=final_message,t.setContent()}}]),app.controller("communicationListCtrl",["$scope","$rootScope","DBService",function(t,e,a){t.max=50,t.pn=1,t.total_pn=0,t.count=0,t.checkAll=!1,t.show_list=!0,t.show_removed_list=!0,t.send_type_check=1,t.removed_students=[],t.formData={demo_check:!1},t.filter={only_active:1,cities:[],centers:[],groups:[],status:[],categories:[],batch_types:[]},t.template_lists=[],t.listing=function(){a.postCall({},"/api/communications/send-message/listing").then(function(e){e.success&&(t.communications=e.communications,t.count=e.count)})},t.viewStudetns=function(e){t.comm_pn=1,t.total_comm_pn=0,t.open_comm=e,$("#students").modal("show"),t.commStudents(1)},t.nextPageComm=function(){(t.comm_pn+1)*t.max<=t.count+t.max&&t.commStudents(t.comm_pn+1)},t.prevPageComm=function(){0<t.comm_pn-1&&t.commStudents(t.comm_pn-1)},t.commStudents=function(e){t.open_comm.pn=e,t.comm_pn=e,a.postCall(t.open_comm,"/api/communications/send-message/comm_students").then(function(e){t.open_comm.students=e.students,t.loading_students=!1,t.total_comm_pn=e.total_pn,t.count=e.count})}}]),app.controller("emailTempCtrl",["$scope","$http","$timeout","DBService",function(o,e,t,s){o.formData={},o.init=function(){s.getCall("/api/communications/email-template/init").then(function(e){o.templates=e.templates})},o.add=function(){o.formData={},$("#add-template").modal("show")},o.onSubmit=function(){o.processing=!0,s.postCall(o.formData,"/api/communications/email-template/store").then(function(e){e.success?($("#add-template").modal("hide"),bootbox.alert(e.message),o.init()):bootbox.alert(e.message),o.processing=!1})},o.edit=function(e){o.formData=JSON.parse(JSON.stringify(e)),$("#add-template").modal("show")},o.delete=function(t,a){bootbox.confirm("Are you sure?",e=>{e&&s.getCall("/api/communications/email-template/delete/"+t).then(function(e){e.success&&o.templates.splice(a,1),bootbox.alert(e.message)})})}}]),app.controller("stock_controller",["$scope","$http","DBService","Upload",function(t,e,a,o){t.loading=!1,t.dataset=[],t.filter={page_no:1,max_per_page:20,max_page:1,order_by:"",order_type:"ASC",export:!1,show:!1},t.total=0,t.init=function(){t.loading=!0,a.postCall(t.filter,"/api/inventory/current-stock/get-stock").then(function(e){e.success?t.filter.export?window.open(e.excel_link,"_blank"):(t.dataset=e.stocks,t.total=e.total,t.filter.max_page=Math.ceil(t.total/t.filter.max_per_page)):bootbox.alert(e.message),t.loading=!1,t.filter.searching=!1,t.filter.clearing=!1,t.filter.exporting=!1,t.filter.export=!1,t.setPagination()})},t.getStateCityCenter=function(e){a.postCall({Tag:e},"/api/get-state-city-center-data").then(function(e){e.success&&(t.state_city_center=e)})},t.getStateCityCenter(),t.searchList=function(){t.filter.page_no=1,t.filter.searching=!1,t.init()},t.clear=function(){t.filter={page_no:1,max_per_page:20,max_page:1,clearing:!0},t.init()},t.exportList=function(){console.log("exporting"),t.exporting=!0,t.filter.export=!0,t.init()}}]),app.controller("Request_controller",["$scope","$http","DBService","Upload",function(o,e,s,a){o.loading=!1,o.dataset=[],o.price_type={},o.viewData={},o.requestData={items:[{}]},o.fileObj={document:"",link:""},o.optionItem={},o.filter={page_no:1,max_per_page:20,max_page:1,order_by:"",order_type:"ASC",export:!1,show:!1},o.total=0,o.approveOrReject={},o.init=function(){o.loading=!0,s.postCall(o.filter,"/api/inventory/request/get-request").then(function(e){e.success?o.filter.export?window.open(e.excel_link,"_blank"):(o.dataset=e.request,o.total=e.total,o.filter.max_page=Math.ceil(o.total/o.filter.max_per_page)):bootbox.alert(e.message),o.loading=!1,o.filter.searching=!1,o.filter.clearing=!1,o.filter.exporting=!1,o.filter.export=!1,o.setPagination()})},o.getStateCityCenter=function(e){s.postCall({Tag:e},"/api/get-state-city-center-data").then(function(e){e.success&&(o.state_city_center=e)})},o.company=function(){s.postCall(o.filter,"/api/inventory/request/get-companies").then(function(e){e.success&&(o.companies=e.companies)})},o.searchList=function(){o.filter.page_no=1,o.filter.searching=!1,o.getList()},o.clear=function(){o.filter={page_no:1,max_per_page:20,max_page:1,clearing:!0},o.getList()},o.exportList=function(){console.log("exporting"),o.exporting=!0,o.filter.export=!0,o.getList()},o.addItem=function(){o.requestData.items.push(JSON.parse(JSON.stringify(o.optionItem)))},o.removeItem=function(e){o.items.splice(e,1)},o.uploadDocument=function(e){var t=base_url+"/uploads/file";a.upload({url:t,data:{file:e}}).then(function(e){console.log(e.data),o.requestData.link=e.data.url,o.requestData.document=e.data.path})},o.removeFile=function(){o.requestData.document=""},o.saveRequest=function(){o.loading=!0,s.postCall(o.requestData,"/api/inventory/request/save-request").then(function(e){e.success?(window.location=base_url+"/inventory/request",o.loading=!1):bootbox.alert(e.message)})},o.formData=function(t){s.getCall("/api/inventory/request/request-data/"+t).then(function(e){e.success&&0!=t&&(o.requestData=e.request),o.company(),o.getStateCityCenter("inv_user"),o.allItems()})},o.viewInventoryRequest=function(e){o.rowId=e,s.getCall("/api/inventory/request/view-data/"+e).then(function(e){e.success&&(o.viewData=e.request,o.viewitems=e.items,$("#request-view-modal").modal("show"))})},o.changeStatus=function(){o.approveOrReject.id=o.rowId,s.postCall(o.approveOrReject,"/api/inventory/request/approve-or-reject").then(function(e){if(e.success){bootbox.alert(e.message),$("#request-view-modal").modal("hide");for(var t=0;t<o.dataset.length;t++)o.dataset[t].id==o.rowId&&(o.dataset[t].status=e.new_status)}else bootbox.alert(e.message);o.init()})},o.deleteRequest=function(t,a){bootbox.confirm("Are you sure?",e=>{e&&s.getCall("/api/inventory/request/delete-data/"+t).then(function(e){e.success&&(bootbox.alert(e.message),o.dataset.splice(a,1))})})},o.allItems=function(){s.postCall(o.filter,"/api/inventory/request/all-items").then(function(e){e.success&&(o.allItems=e.allItems)})}}]),app.controller("Inventory_controller",["$scope","$http","DBService",function(o,e,s){o.loading=!1,o.dataset=[],o.filter={page_no:1,max_per_page:1,max_page:1,order_by:"",order_type:"ASC",export:!1,show:!1},o.total=0,o.init=function(){o.loading=!0,s.postCall(o.filter,"/api/inventory/get-items").then(function(e){e.success?o.filter.export?window.open(e.excel_link,"_blank"):(o.dataset=e.items,o.units=e.units):bootbox.alert(e.message),o.loading=!1,o.filter.searching=!1,o.filter.clearing=!1,o.filter.exporting=!1,o.filter.export=!1})},o.searchList=function(){o.filter.page_no=1,o.filter.searching=!1,o.getList()},o.clear=function(){o.filter={page_no:1,max_per_page:20,max_page:1,clearing:!0},o.getList()},o.exportList=function(){console.log("exporting"),o.exporting=!0,o.filter.export=!0,o.getList()},o.addItem=function(){o.itemData={},$("#items-modal").modal("show")},o.saveItem=function(){o.processing_req=!0,s.postCall(o.itemData,"/api/inventory/save-items").then(function(e){e.success?(bootbox.alert(e.message),$("#items-modal").modal("hide")):bootbox.alert(e.message),o.init(),o.processing_req=!1})},o.editItem=function(e){o.itemData={},o.itemData=JSON.parse(JSON.stringify(e)),$("#items-modal").modal("show")},o.deleteItem=function(t,a){bootbox.confirm("Are you sure?",e=>{e&&(o.loading=!0,s.getCall("/api/inventory/delete-items/"+t).then(function(e){e.success&&(bootbox.alert(e.message),o.dataset.splice(a,1),o.loading=!1)}))})}}]),app.controller("Company_controller",["$scope","$http","DBService",function(o,e,s){o.loading=!1,o.dataset=[],o.filter={page_no:1,max_per_page:20,max_page:1,order_by:"",order_type:"ASC",export:!1,show:!1},o.companyData={},o.total=0,o.init=function(){o.loading=!0,s.postCall(o.filter,"/api/inventory/companies/get-companies").then(function(e){e.success?o.filter.export?window.open(e.excel_link,"_blank"):(o.dataset=e.items,o.total=e.total,o.filter.max_page=Math.ceil(o.total/o.filter.max_per_page)):bootbox.alert(e.message),o.loading=!1,o.filter.searching=!1,o.filter.clearing=!1,o.filter.exporting=!1,o.filter.export=!1,o.setPagination()})},o.searchList=function(){o.filter.page_no=1,o.filter.searching=!1,o.getList()},o.clear=function(){o.filter={page_no:1,max_per_page:20,max_page:1,clearing:!0},o.getList()},o.exportList=function(){console.log("exporting"),o.exporting=!0,o.filter.export=!0,o.getList()},o.addCompany=function(){o.companyData={},$("#company_modal").modal("show"),o.getStateCityCenter()},o.saveCompany=function(){o.processing_req=!0,s.postCall(o.companyData,"/api/inventory/companies/save-company").then(function(e){e.success?(bootbox.alert(e.message),$("#company_modal").modal("hide")):bootbox.alert(e.message),o.init(),o.processing_req=!1})},o.editCompany=function(e){o.companyData={},o.companyData=JSON.parse(JSON.stringify(e)),$("#company_modal").modal("show"),o.getStateCityCenter()},o.deleteCompany=function(t,a){bootbox.confirm("Are you sure?",e=>{e&&s.getCall("/api/inventory/companies/delete-companies/"+t).then(function(e){e.success&&(bootbox.alert(e.message),o.dataset.splice(a,1),o.loading=!1)})})},o.getStateCityCenter=function(e){s.postCall({Tag:e},"/api/get-state-city-center-data").then(function(e){e.success&&(o.state_city_center=e)})},o.selectCity=function(e){s.getCall("/api/cities/"+e).then(function(e){e.success&&(o.cities=e.cities)})}}]),app.controller("SettingsController",["$scope","$http","DBService","Upload",function(t,e,a,o){t.switchContent="email",t.items=[],t.init=function(){t.loading=!0,a.postCall({category:t.switchContent},"/api/settings/init").then(function(e){e.success&&(t.items=e.items),t.loading=!1})},t.switchContentType=function(e){t.switchContent=e,t.init()},t.uploadImage=function(e,t){t.uploading=!0,name="photo",t.progress=0;var a=base_url+"/upload/photo";o.upload({url:a,data:{photo:e,resize:1,crop:t.crop,width:t.width,height:t.height}}).then(function(e){e.data.success?t.value=e.data.path:alert(e.data.message),t.uploading=!1},function(e){t.uploading=!1},function(e){t.progress=parseInt(100*e.loaded/e.total)+"%"})},t.removeImage=function(e){e.value=""},t.saveSettings=function(){t.processing=!0,a.postCall({items:t.items},"/api/settings/save").then(function(e){t.processing=!1})},t.openEditor=function(e){t.editor_id=e.id,t.editor_data=e.value||"",t.show_editor=!0,$("#editor_modal").modal("show")},t.closeEditorModal=function(){t.show_editor=!1,$("#editor_modal").modal("hide")},t.saveEditorModal=function(){for(var e=0;e<t.items.length;e++)t.items[e].id==t.editor_id&&(t.items[e].value=window.editor.getData());t.show_editor=!1,$("#editor_modal").modal("hide")},t.setData=function(e){t.$apply(()=>{t.editor_data=e})}}]);var init_filters={page_no:1,max_per_page:50,max_page:1,order_by:"",order_type:"ASC",export:!1,show:!1,cities:[],centers:[],status:[],sources:[],sub_sources:[],lead_for:[],action_date_start:"",action_date_end:"",create_start:"",create_end:""};app.controller("leads_controller",["$scope","$http","DBService","Upload",function(o,e,s,a){o.leadData={status:1},o.formData={},o.dataset=[],o.parameters=[],o.loading=!0,o.noteData={},o.filter=init_filters,o.selectedLeads=[],o.init=function(){o.getList(),o.getParams()},o.getList=function(){o.processing=!0,s.postCall(o.filter,"/api/leads").then(function(e){e.success&&(o.dataset=e.leads,o.total=e.total,o.filter.max_page=Math.ceil(o.total/o.filter.max_per_page)),o.loading=!1,o.processing=!1,o.hide_reset=!1})},o.searchList=function(){o.filter.page_no=1,o.getList()},o.getParams=function(){s.getCall("/api/leads/params").then(function(e){e.success&&(o.parameters=e,o.getGeo())})},o.getGeo=function(){s.postCall({Tag:"lead_op"},"/api/get-state-city-center-data").then(function(e){e.success&&(o.parameters.state=e.state,o.parameters.city=e.city,o.parameters.center=e.center,o.parameters.group=e.group)})},o.addFilter=function(e,t){var a=o.filter[e].indexOf(t);-1==a?o.filter[e].push(t):o.filter[e].splice(a,1),"cities"==e&&o.showFilterCenters()},o.showFilterCenters=function(){o.filter_centers=[];for(var e,t=0;t<o.parameters.center.length;t++)-1!=o.filter.cities.indexOf(o.parameters.center[t].city_id)?o.filter_centers.push(o.parameters.center[t]):-1!=(e=o.filter.centers.indexOf(o.parameters.center[t].value))&&o.filter.centers.splice(e,1)},o.resetAll=function(){o.filter_centers=[],o.filter=init_filters,$(".filters input[type=checkbox]").removeAttr("checked"),o.hide_reset=!0,o.getList()},o.addLead=function(){o.leadData={status:1,action_date:o.current_date},o.checkReason(1),$("#add-lead").modal("show")},o.checkReason=function(e){o.status_row={date_req:0,call_note_req:0,reason_req:0};for(var t=0;t<o.parameters.status.length;t++)o.parameters.status[t].value==e&&(o.status_row=o.parameters.status[t]);console.log(o.status_row)},o.onSubmitLead=function(){o.processing_req=!0,s.postCall(o.leadData,"/api/leads/store").then(function(e){e.success&&(o.leadData.id?(o.edit_lead=!1,e.lead.history=o.leadData.history,o.leadData=e.lead):($("#add-lead").modal("hide"),o.dataset.unshift(e.lead))),bootbox.alert(e.message),o.processing_req=!1})},o.addNote=function(e){o.lead_index=e,o.leadData=JSON.parse(JSON.stringify(o.dataset[e])),o.noteData.lead_id=o.leadData.id,o.noteData.assigned_to=o.leadData.assigned_to,o.noteData.status=0,o.noteData.action_date="",o.noteData.reason_id="",o.edit_loading=!1,$("#addNote").modal("show"),o.leadHistory()},o.leadHistory=function(){s.postCall({},"/api/leads/history/"+o.leadData.id).then(function(e){e.success?o.leadData.history=e.history:bootbox.alert(e.message),o.edit_loading=!1})},o.addNoteSubmit=function(){o.adding_note=!0,s.postCall(o.noteData,"/api/leads/addNote").then(function(e){e.success&&(o.leadHistory(),o.noteData.status=0,o.noteData.action_date="",o.noteData.reason_id="",o.leadForm.$setPristine(),o.leadData.status_value=e.lead.status_value,o.leadData.assigned_member=e.lead.assigned_member,o.leadData.action_date=e.lead.action_date,o.dataset[o.lead_index]=e.lead),bootbox.alert(e.message),o.adding_note=!1})},o.getAge1=function(){s.postCall({dob:o.leadData.dob},"/api/getAge").then(function(e){o.leadData.age=e})},o.viewDetails1=function(e){o.openLead={},o.openLead=e,o.openLead.sms_text="",$("#viewDetails").modal("show")},o.bulk_upload1=function(){$("#bulk_upload_lead").modal("show")},o.uploadLeads=function(e){var t;o.errMsg=!1,e&&(o.bulk_upload_processing=!0,t=base_url+"/api/leads/bulk-lead",a.upload({url:t,data:{media:e}}).then(function(e){console.log(e),e.data.success?(o.uploading_percentage=!1,alert(e.data.message)):(o.uploading_percentage=0,o.errMsg=e.data.message),o.bulk_upload_processing=!1},function(e){console.log("Error status: "+e.status),o.bulk_upload_processing=!1},function(e){o.uploading_percentage=parseInt(100*e.loaded/e.total)}))},o.delete1=function(t,a){t.processing=!0,s.getCall("/api/leads/delete/"+t.id).then(function(e){e.success&&o.dataset.splice(a,1),alert(e.message),t.processing=!1})},o.addSelectedLead=function(e){var t;-1<o.selectedLeads.indexOf(e.id)?(t=o.selectedLeads.indexOf(e.id),o.selectedLeads.splice(t,1)):o.selectedLeads.push(e.id)},o.checkAll=function(){o.formData.checkAll=!o.formData.checkAll;for(var e,t=0;t<o.dataset.length;t++)o.formData.checkAll?o.selectedLeads.indexOf(o.dataset[t].id)<0&&o.selectedLeads.push(o.dataset[t].id):(e=o.selectedLeads.indexOf(o.dataset[t].id),o.selectedLeads.splice(e,1))},o.selectAllFilterLeads=function(){o.selecting_all_leads=!0,s.postCall(o.filter,"/api/leads?type=only_ids").then(function(e){e.success&&(o.selectedLeads=e.lead_ids,o.selecting_all_leads=!1)})},o.sendMessage=function(){o.formData={},$("#messageForm").modal("show")},o.getCities=function(){s.getCall("/api/cities/"+o.leadData.client_state_id).then(function(e){o.parameters.cities=e.cities})}}]),app.controller("master_leads_controller",["$scope","$http","DBService","Upload",function(o,e,s,t){o.leads_for=[],o.lead_status=[],o.lead_reasons=[],o.lead_sources=[],o.lead_for={},o.lead_sts={},o.lead_reason={},o.lead_source={},o.init=function(){o.leadsFor(),o.leadStatus(),o.leadReasons(),o.leadSources()},o.leadsFor=function(){s.getCall("/api/master-leads/leads-for").then(function(e){e.success&&(o.leads_for=e.leadsFor)})},o.leadStatus=function(){s.getCall("/api/master-leads/lead-status").then(function(e){e.success&&(o.lead_status=e.leadStatus)})},o.leadReasons=function(){s.getCall("/api/master-leads/lead-reasons").then(function(e){e.success&&(o.lead_reasons=e.leadReasons)})},o.leadSources=function(){s.getCall("/api/master-leads/lead-sources").then(function(e){e.success&&(o.lead_sources=e.leadSources)})},o.createLeadFor=function(){o.lead_for={},$("#lead_for_modal").modal("show")},o.submitLeadFor=function(){o.leadForProcessing=!0,s.postCall(o.lead_for,"/api/master-leads/lead-for-store").then(function(e){e.success?(bootbox.alert(e.message),$("#lead_for_modal").modal("hide"),o.leadsFor()):bootbox.alert(e.message),o.leadForProcessing=!1})},o.editLeadFor=function(e){o.lead_for=JSON.parse(JSON.stringify(o.leads_for[e])),$("#lead_for_modal").modal("show")},o.deleteLeadFor=function(t,a){bootbox.confirm("Are you sure?",e=>{e&&s.getCall("/api/master-leads/lead-for-delete/"+t).then(function(e){e.success&&(bootbox.alert(e.message),o.leads_for.splice(a,1))})})},o.editLeadStatus=function(e){o.lead_sts=JSON.parse(JSON.stringify(o.lead_status[e])),$("#lead_status_modal").modal("show")},o.submitLeadStatus=function(){o.leadstatusProcessing=!0,s.postCall(o.lead_sts,"/api/master-leads/lead-status").then(function(e){e.success?(bootbox.alert(e.message),$("#lead_status_modal").modal("hide"),o.leadStatus()):bootbox.alert(e.message),o.leadstatusProcessing=!1})},o.createLeadReason=function(){o.lead_reason={},$("#lead_reason_modal").modal("show")},o.submitLeadReason=function(){o.leadReasonProcessing=!0,s.postCall(o.lead_reason,"/api/master-leads/lead-reason").then(function(e){e.success?(bootbox.alert(e.message),$("#lead_reason_modal").modal("hide"),o.leadReasons()):bootbox.alert(e.message),o.leadReasonProcessing=!1})},o.editLeadReasons=function(e){o.lead_reason=JSON.parse(JSON.stringify(o.lead_reasons[e])),$("#lead_reason_modal").modal("show")},o.deleteLeadReasons=function(t,a){bootbox.confirm("Are you sure?",e=>{e&&s.getCall("/api/master-leads/lead-reason-delete/"+t).then(function(e){e.success&&(bootbox.alert(e.message),o.lead_reasons.splice(a,1))})})},o.createLeadSources=function(){o.lead_source={},$("#lead_source_modal").modal("show")},o.submitLeadSource=function(){o.leadSourceProcessing=!0,s.postCall(o.lead_source,"/api/master-leads/lead-source").then(function(e){e.success?(bootbox.alert(e.message),$("#lead_source_modal").modal("hide"),o.leadSources()):bootbox.alert(e.message),o.leadSourceProcessing=!1})},o.editLeadSources=function(e){o.lead_source=JSON.parse(JSON.stringify(o.lead_sources[e])),$("#lead_source_modal").modal("show")},o.deleteLeadSources=function(t,a){bootbox.confirm("Are you sure?",e=>{e&&s.getCall("/api/master-leads/lead-source-delete/"+t).then(function(e){e.success&&(bootbox.alert(e.message),o.lead_sources.splice(a,1))})})}}]),app.controller("Parameters_controller",["$scope","$http","DBService",function(o,e,a){o.group_type_id=0,o.sport_id=0,o.loading=!0,o.processing=!1,o.formData={},o.attrData={},o.groupSkillAttribute={},o.skillAttributeId=[],o.init=function(){a.getCall("/api/parameters/get-parameters/"+o.sport_id).then(function(e){o.parameters=e.skill_categories,o.groupTypes(),o.loading=!1})},o.groupTypes=function(){a.getCall("/api/parameters/get-group-types").then(function(e){o.group_types=e.group_types})},o.addCategory=function(){$("#category-modal").modal("show")},o.saveCategory=function(){o.processing=!0,o.formData.sport_id=o.sport_id,a.postCall(o.formData,"/api/parameters/save-category").then(function(e){e.success?(bootbox.alert(e.message),o.init(),$("#category-modal").modal("hide")):bootbox.alert(e.message),o.processing=!1})},o.editCategory=function(e){o.formData=JSON.parse(JSON.stringify(e)),$("#category-modal").modal("show")},o.deleteCategory=function(t){bootbox.confirm("Are you sure?",e=>{e&&(o.processing=!0,a.getCall("/api/parameters/delete-category/"+t).then(function(e){e.success?(bootbox.alert(e.message),o.init()):bootbox.alert(e.message),o.processing=!1}))})},o.addAttribute=function(e){o.parameter_id=e,$("#attribute-modal").modal("show")},o.saveAttribute=function(){o.attrData.category_id=o.parameter_id,o.processing=!0,a.postCall(o.attrData,"/api/parameters/save-attribute").then(function(e){e.success?(bootbox.alert(e.message),o.init(),$("#attribute-modal").modal("hide")):bootbox.alert(e.message),o.processing=!1})},o.editAttribute=function(e){o.attrData=JSON.parse(JSON.stringify(e)),$("#attribute-modal").modal("show")},o.deleteAttribute=function(t){bootbox.confirm("Are you sure?",e=>{e&&(o.processing=!0,a.getCall("/api/parameters/delete-attribute/"+t).then(function(e){e.success&&(bootbox.alert(e.message),o.init()),o.processing=!1}))})},o.toggleAttr=function(t){o.groupSkillAttribute.skill_attribute_id=t.id,o.groupSkillAttribute.group_type_id=o.group_type_id,a.postCall(o.groupSkillAttribute,"/api/parameters/save-group-skill-attribute").then(function(e){e.success&&(t.value=e.value)})},o.changeGroup=function(){0!=o.group_type_id&&a.getCall("/api/parameters/get-group-skill-attribute/"+o.group_type_id).then(function(e){if(e.success){ids=e.skillAttributeIds;for(var t=0;t<o.parameters.length;t++)for(var a=0;a<o.parameters[t].attributes.length;a++)console.log(ids.indexOf(o.parameters[t].attributes[a].id)),-1<ids.indexOf(o.parameters[t].attributes[a].id)?o.parameters[t].attributes[a].value=1:o.parameters[t].attributes[a].value=0}})}}]),app.controller("User_controller",["$scope","$http","DBService",function(o,e,a){o.user_id="",o.edit=!1,o.filterData={show:!0},o.access_location_data={centers_ids:[],groups_ids:[]},o.access_right_type=[{id:1,type:"All Access"},{id:2,type:"City"},{id:3,type:"Center"},{id:4,type:"Group"}],o.ac_provideer=!1,o.add_user={role:0,gender:"",city_id:"0"},o.users_roles=[],o.userInit=function(){o.getCityCenter("users"),a.postCall({},"/api/users/list").then(function(e){o.users_list=e.users_list,o.all_access=e.access})},o.getRoles=function(){a.getCall("/api/users/get-roles").then(function(e){e.success&&(o.users_roles=e.user_roles)})},o.getCityCenter=function(e){a.postCall({Tag:e},"/api/get-state-city-center-data").then(function(e){o.cityCenter=e,o.loading=!1})},o.editUserInit=function(e){o.user_id=e,o.access_location_data.user_id=e,o.getLocations("users"),a.getCall("/api/users/edit/"+e).then(function(e){e.success&&(o.add_user=e.user,o.sports=e.sports,o.getUserAccess())}),o.getRoles()},o.getLocations=function(e){a.postCall({Tag:e},"/api/get-state-city-center-data").then(function(e){o.all_city_list=e.city,o.all_center_list=e.center,o.all_group_list=e.group,o.ac_provideer=e.all_access})},o.saveUser=function(){o.processing_req=!0,a.postCall(o.add_user,"/api/users/save").then(function(e){1==e.success&&e.new_user?window.location=base_url+"/users/edit/"+e.id:bootbox.alert(e.message),o.processing_req=!1})},o.deleteUser=function(t){bootbox.confirm("Are you sure?",e=>{e&&a.postCall({user_id:t.id},"/api/users/delete").then(function(e){e.success&&(t.inactive=e.inactive),bootbox.alert(e.message)})})},o.getUserAccess=function(){0!=o.user_id&&a.postCall({user_id:o.user_id,role_id:o.add_user.role},"/api/users/access-rights-loc").then(function(e){e.success?o.user_access_rights=e.access_rights:bootbox.alert(e.message)})},o.delete_access_location_data=function(e){confirm("Are you sure to delete this access location?")&&a.postCall({access_location_id:e.id,user_id:o.user_id},"/api/users/access-rights-loc/delete").then(function(e){e.success&&o.getUserAccess()})},o.show_location_access_model=function(e,t){o.access_location_data.access_type_id=t.id,1==e&&(o.access_location_data.modal_id=1,o.access_location_data.city=!0,o.access_location_data.city_id=-1,o.submit_access_location_data()),2==e&&(o.access_location_data.modal_id=2,o.access_location_data.city=!0,o.access_location_data.center=!1,o.access_location_data.group=!1,o.access_location_data.city_id=0,$("#location_access").modal("show")),3==e&&(o.access_location_data.modal_id=3,o.access_location_data.city=!0,o.access_location_data.center=!0,o.access_location_data.group=!1,o.access_location_data.city_id=0,$("#location_access").modal("show")),4==e&&(o.access_location_data.modal_id=4,o.access_location_data.center=!0,o.access_location_data.city=!0,o.access_location_data.group=!0,o.access_location_data.city_id=0,$("#location_access").modal("show"))},o.submit_access_location_data=function(){o.access_location_data.role_id=o.add_user.role,a.postCall(o.access_location_data,"/api/users/access-rights-loc/add").then(function(e){e.success?o.getUserAccess():bootbox.alert(e.message)}),o.hide_location_access_model()},o.clear_center_ids=function(){o.access_location_data.centers_ids=[]},o.clear_group_ids=function(){o.access_location_data.groups_ids=[]},o.add_center_in_access_location=function(e){o.access_location_data.centers_ids.includes(e)?o.access_location_data.centers_ids.splice(o.access_location_data.centers_ids.indexOf(e),1):o.access_location_data.centers_ids.push(e)},o.add_group_in_access_location=function(e){o.access_location_data.groups_ids.includes(e)?o.access_location_data.groups_ids.splice(o.access_location_data.groups_ids.indexOf(e),1):o.access_location_data.groups_ids.push(e)},o.copyToAll=function(t){bootbox.confirm("Are you sure to copy to all other access?",e=>{e&&a.postCall({user_id:o.user_id,access_right_id:t},"/api/users/access-rights-loc/copy").then(function(e){e.success&&o.getUserAccess(),bootbox.alert(e.message)})})},o.hide_location_access_model=function(){$("#location_access").modal("hide")},o.addUserModal=function(){o.add_user={},o.UserForm.$setPristine(),o.getRoles(),$("#add_user_modal").modal("show")},o.hideModal=function(e){$("#"+e).modal("hide")},o.addSports=function(e,t){var a=o.add_user[t].indexOf(e);-1<a?o.add_user[t].splice(a,1):o.add_user[t].push(e)}}]),app.controller("AccessRights_controller",["$scope","$http","DBService",function(t,e,a){t.edit=!1,t.users_roles={},t.users_right_names={},t.add_access_rights={},t.accessRightsInit=function(){a.postCall({},"/api/users/access-rights/list").then(function(e){t.users_right_names=e.user_access_rights,t.access=e.access})},t.addAccessRights=function(){console.log("--",t.add_access_rights),a.postCall({rights_data:t.add_access_rights},"/api/users/access-rights/add").then(function(e){1==e.success.success&&(alert("Access Rights added successfully"),location.reload())})},t.updateAccessRights=function(){console.log("--",t.add_access_rights),a.postCall({rights_data:t.add_access_rights},"/api/users/access-rights/update").then(function(e){1==e.success.success&&(alert("Access Rights updated successfully"),location.reload())})},t.editRights=function(e){t.edit=!0,t.add_access_rights=e,t.add_access_rights.show||(t.add_access_rights.show=!0),window.scroll(0,0)},t.deleteRights=function(e){confirm("Are you sure to delete Access Right")&&a.postCall({roles:e},"/api/users/access-rights/delete").then(function(e){1==e.success&&(alert("Rights deleted successfully"),location.reload())})}}]),app.controller("Roles_controller",["$scope","$http","DBService",function(a,e,o){a.edit=!1,a.users_roles={},a.users_right_names={},a.add_roles={access_rights:[]},a.roles_init=function(){o.postCall({},"/api/users/roles/list").then(function(e){a.users_roles=e.user_roles,a.users_right_names=e.user_access_rights})},a.add_user_roles=function(){a.processing_req=!0,o.postCall(a.add_roles,"/api/users/roles/add").then(function(e){e.success&&(a.roles_init(),$("#add_roles_modal").modal("hide")),bootbox.alert(e.message),a.add_roles.show=!1,a.processing_req=!1})},a.edit_roles=function(e){a.edit=!0,a.add_roles=e,a.add_roles.show||(a.add_roles.show=!0),$("#add_roles_modal").modal("show")},a.delete_roles=function(t){bootbox.confirm("Are you sure?",e=>{e&&o.postCall({id:t.id},"/api/users/roles/delete").then(function(e){1==e.success&&a.roles_init(),bootbox.alert(e.message)})})},a.add_rights=function(e){a.add_roles.access_rights.includes(e)?a.add_roles.access_rights.splice(a.add_roles.access_rights.indexOf(e),1):a.add_roles.access_rights.push(e)},a.addUserRoles=function(){a.edit=!1,a.add_roles={access_rights:[]},$("#add_roles_modal").modal("show")},a.hideModal=function(e){$("#"+e).modal("hide")}}]),app.controller("CityController",["$scope","$http","DBService",function(a,e,o){a.state_data={},a.city_data={},a.add_city={},a.city_list={},a.cityInit=function(){o.getCall("/api/states").then(function(e){e.success&&(a.state_data=e.states,a.getCityList())})},a.getCityList=function(){o.postCall({},"/api/city/list").then(function(e){a.city_list=e.city_list})},a.addCity=function(){a.add_city={},$("#city_modal").modal("show")},a.selectCity=function(e){o.getCall("/api/cities/"+e).then(function(e){e.success&&(a.city_data=e.cities)})},a.hideModal=function(){$("#city_modal").modal("hide")},a.putCityName=function(){for(var e="",t=0;t<a.city_data.length;t++)a.city_data[t].value==a.add_city.base_city_id&&(e=a.city_data[t].label);a.add_city.city_name=e},a.saveCity=function(){a.processing_req=!0,o.postCall(a.add_city,"/api/city/save").then(function(e){e.success&&(a.add_city={},a.getCityList(),$("#city_modal").modal("hide")),bootbox.alert(e.message),a.processing_req=!1})},a.editCity=function(e){a.add_city=e,a.selectCity(e.state_id),$("#city_modal").modal("show")},a.deleteCity=function(t){bootbox.confirm("Are you sure?",e=>{e&&o.postCall({id:t},"/api/city/delete").then(function(e){e.success&&a.getCityList(),bootbox.alert(e.message)})})}}]),app.controller("payments_controller",["$scope","$http","DBService",function(t,e,a){t.pay_history={},t.dataset=[],t.params=[],t.filter={page_no:1,max_per_page:20,max_page:1,order_by:"",order_type:"ASC",export:!1},t.loading=!0,t.total=0,t.submitPayPrice=function(e){console.log(e)},t.getList=function(){t.loading=!0,a.postCall(t.filter,"/api/payments").then(function(e){e.success?t.filter.export?window.open(e.excel_link,"_blank"):(t.dataset=e.payments,t.total=e.total,t.filter.max_page=Math.ceil(t.total/t.filter.max_per_page)):bootbox.alert(e.message),t.loading=!1,t.filter.searching=!1,t.filter.clearing=!1,t.filter.exporting=!1,t.filter.export=!1})},t.getList(),t.searchList=function(){t.filter.page_no=1,t.filter.searching=!1,t.getList()},t.viewPayment=function(e){a.getCall("/api/student/payment/view-payment/"+e).then(function(e){t.payment=e.payment,$("#viewPaymentModal").modal("show")})}}]),app.controller("coupon_controller",["$scope","$http","DBService",function(o,e,s){o.edit=!1,o.price_type={},o.price_type_data={},o.couponData={},o.formData={},o.payTypePriceList={},o.access_type_id="",o.add_PPD={city_ids:[],centers_ids:[],groups_ids:[]},o.access_location_data={centers_ids:[],groups_ids:[]},o.access_right_type=[{id:1,type:"All City Access"},{id:2,type:"City"},{id:3,type:"Center"},{id:4,type:"Group"}],o.init=function(){o.processing=!0,s.postCall({sport_id:o.sport_id},"/api/pay-type-price/get-pay-type-data").then(function(e){e.success&&(o.price_type.pay_type_cat=e.pay_type_cat,o.price_type.pay_type=e.pay_type)}),s.postCall({Tag:"pt-edit"},"/api/get-state-city-center-data").then(function(e){o.price_type.city=e.city,o.price_type.center=e.center,o.price_type.group=e.group,o.processing=!1})},o.getCouponList=function(){s.postCall({sport_id:o.sport_id},"/api/coupons/get-coupons-list").then(function(e){o.couponData=e.coupons,o.processing=!1})},o.showCouponModal=function(){o.formData={},$("#coupon_type_modal").modal("show")},o.getLocations=function(e){s.postCall({Tag:e},"/api/get-state-city-center-data").then(function(e){o.all_city_list=e.city,o.all_center_list=e.center,o.all_group_list=e.group,o.ac_provideer=e.all_access})},o.addCoupon=function(e){o.couponProcessing=!0,o.formData.sport_id=o.sport_id,s.postCall(o.formData,"/api/coupons/add").then(function(e){e.success?(bootbox.alert(e.message),o.getCouponList(),$("#coupon_type_modal").modal("hide")):bootbox.alert(e.message),o.couponProcessing=!1})},o.editCoupon=function(e){o.formData=JSON.parse(JSON.stringify(e)),$("#coupon_type_modal").modal("show")},o.deleteCoupon=function(t,a){bootbox.confirm("Are you sure?",e=>{e&&s.getCall("/api/coupons/delete-coupon/"+t.id).then(function(e){e.success?(bootbox.alert(e.message),o.couponData.splice(a,1)):bootbox.alert(e.message)})})},o.show_location_access_model=function(e){o.coupon_id=e.id;e=e.type;o.getLocations(),1==e&&(o.access_location_data.modal_id=1,o.access_location_data.city=!0,o.access_location_data.city_id=-1,o.submit_access_location_data()),2==e&&(o.access_location_data.modal_id=2,o.access_location_data.city=!0,o.access_location_data.center=!1,o.access_location_data.group=!1,o.access_location_data.city_id=0,$("#location_access").modal("show")),3==e&&(o.access_location_data.modal_id=3,o.access_location_data.city=!0,o.access_location_data.center=!0,o.access_location_data.group=!1,o.access_location_data.city_id=0,$("#location_access").modal("show")),4==e&&(o.access_location_data.modal_id=4,o.access_location_data.center=!0,o.access_location_data.city=!0,o.access_location_data.group=!0,o.access_location_data.city_id=0,$("#location_access").modal("show"))},o.add_center_in_access_location=function(e){o.access_location_data.centers_ids.includes(e)?o.access_location_data.centers_ids.splice(o.access_location_data.centers_ids.indexOf(e),1):o.access_location_data.centers_ids.push(e)},o.add_group_in_access_location=function(e){o.access_location_data.groups_ids.includes(e)?o.access_location_data.groups_ids.splice(o.access_location_data.groups_ids.indexOf(e),1):o.access_location_data.groups_ids.push(e)},o.submit_access_location_data=function(){s.postCall({availibility:o.access_location_data,coupon_id:o.coupon_id},"/api/coupons/add-availibility").then(function(e){1==e.success?(alert(e.message),o.getCouponList()):alert(e.message)}),o.hide_location_access_model()},o.hide_location_access_model=function(){$("#location_access").modal("hide")},o.delete_coupon_mapping=function(t){bootbox.confirm("Are you sure?",e=>{e&&s.getCall("/api/coupons/delete-availibility/"+t.id).then(function(e){e.success?(bootbox.alert(e.message),o.getCouponList()):bootbox.alert(e.message)})})}}]),app.controller("payments_type_category_controller",["$scope","$http","DBService",function(a,e,o){a.sport_id=0,a.pay_cat_list={},a.add_cat_item={},a.edit_cat_item={},a.Category={},a.loading=!0,a.processing=!1,a.init=function(){o.postCall({sport_id:a.sport_id},"/api/pay-type-category/list").then(function(e){e.success&&(a.pay_cat_list=e,a.loading=!1)})},a.add=function(){a.processing=!0,a.add_cat_item.sport_id=a.sport_id,o.postCall(a.add_cat_item,"/api/pay-type-category/add").then(function(e){e.success?($("#add_pay_modal").modal("hide"),a.init(),bootbox.alert(e.message),a.processing=!1,a.add_cat_item={}):(bootbox.alert(e.message),a.processing=!1)})},a.addCategory=function(){a.processing=!0,a.Category.sport_id=a.sport_id,o.postCall(a.Category,"/api/pay-type-category/add-category").then(function(e){e.success&&($("#add_category_modal").modal("hide"),$("#edit_category_modal").modal("hide"),a.init()),a.processing=!1,bootbox.alert(e.message)})},a.update=function(e){a.updateProcessing=!0,o.postCall(e,"/api/pay-type-category/update").then(function(e){e.success?(a.hide_data_modal("edit_category_item"),bootbox.alert(e.message),a.init()):bootbox.alert(e.message),a.updateProcessing=!1})},a.delete=function(t){bootbox.confirm("Are you sure?",e=>{e&&(a.deleteProcessing=!0,o.postCall({id:t},"/api/pay-type-category/delete").then(function(e){e.success?(bootbox.alert(e.message),a.hide_data_modal("edit_category_item"),a.init()):bootbox.alert(e.message),a.deleteProcessing=!1}))})},a.disableCategory=function(){bootbox.confirm("Are you sure?",e=>{e&&(a.disableProcessing=!0,o.postCall({id:a.Category.id},"/api/pay-type-category/disable-category").then(function(e){e.success&&($("#edit_category_modal").modal("hide"),a.init()),a.disableProcessing=!1,bootbox.alert(e.message)}))})},a.deleteCategory=function(){bootbox.confirm("Are you sure?",e=>{e&&(a.deleteProcessing=!0,o.postCall({id:a.Category.id},"/api/pay-type-category/delete-category").then(function(e){e.success&&($("#edit_category_modal").modal("hide"),a.init()),a.deleteProcessing=!1,bootbox.alert(e.message)}))})},a.editCategoryModal=function(e){a.Category=e,$("#edit_category_modal").modal("show")},a.addPayCategory=function(){a.Category={},$("#add_category_modal").modal("show")},a.addPaySubCategory=function(e,t){a.is_sub_type=t,a.add_cat_item.category_id=e,$("#add_pay_modal").modal("show")},a.show_data_modal=function(e,t){a.edit_cat_item=t,$("#"+e).modal("show")},a.hide_data_modal=function(e){$("#"+e).modal("hide")}}]),app.controller("payments_type_controller",["$scope","$http","DBService",function(a,e,o){a.sport_id=0,a.edit=!1,a.price_type={},a.price_type_data={},a.get_PTData={},a.add_PPD={city_ids:[],centers_ids:[],groups_ids:[]},a.payTypePriceList={},a.access_type_id="",a.getCityCenterGroup=function(){o.postCall({sport_id:a.sport_id},"/api/pay-type-price/get-pay-type-data").then(function(e){e.success&&(a.price_type.pay_type_cat=e.pay_type_cat,a.price_type.pay_type=e.pay_type)}),o.postCall({Tag:"pay_structure"},"/api/get-state-city-center-data").then(function(e){a.price_type.city=e.city,a.price_type.center=e.center,a.price_type.group=e.group})},a.getPayPriceList=function(){a.get_PTData.pay_type_id&&(a.processing=!0,o.postCall({type_id:a.get_PTData.pay_type_id},"/api/pay-type-price/list").then(function(e){e.success&&(a.payTypePriceList=e.list,a.texPercentage=e.texPercentage,a.processing=!1)}))},a.show_data_modal=function(e){a.add_PPD.tax=a.texPercentage.tax,$("#"+e).modal("show")},a.hide_data_modal=function(e){$("#"+e).modal("hide")},a.openAddPayPrice=function(e){a.hide_data_modal("price_access"),a.show_data_modal(e)},a.showAddPayPriceData=function(e,t){a.add_PPD={centers_ids:[],groups_ids:[],city_ids:[]},a.edit=!1,a.add_PPD.pay_type_cat_id=a.get_PTData.pay_type_cat_id,a.add_PPD.pay_type_id=a.get_PTData.pay_type_id,1==(a.add_PPD.modal_id=e)&&(a.add_PPD.city=!0,a.add_PPD.city_id=-1,a.openAddPayPrice("price_type_modal")),2==e&&(a.add_PPD.city=!0,a.add_PPD.center=!1,a.add_PPD.group=!1,a.show_data_modal(t)),3==e&&(a.add_PPD.city=!0,a.add_PPD.center=!0,a.add_PPD.group=!1,a.add_PPD.city_id=0,a.show_data_modal(t)),4==e&&(a.add_PPD.city=!0,a.add_PPD.center=!0,a.add_PPD.group=!0,a.add_PPD.city_id=0,a.show_data_modal(t))},a.add_city_in_access_location=function(e){a.add_PPD.city_ids.includes(e)?a.add_PPD.city_ids.splice(a.add_PPD.city_ids.indexOf(e),1):a.add_PPD.city_ids.push(e)},a.add_center_in_access_location=function(e){a.add_PPD.centers_ids.includes(e)?a.add_PPD.centers_ids.splice(a.add_PPD.centers_ids.indexOf(e),1):a.add_PPD.centers_ids.push(e)},a.add_group_in_access_location=function(e){a.add_PPD.groups_ids.includes(e)?a.add_PPD.groups_ids.splice(a.add_PPD.groups_ids.indexOf(e),1):a.add_PPD.groups_ids.push(e)},a.countTotal=function(e){total=parseInt(e.price*e.tax)/100+parseInt(e.price),e.total_amt=total},a.addPayPriceData=function(t){a.processing_req=!0,o.postCall(t,"/api/pay-type-price/add").then(function(e){e.success?(bootbox.alert(e.message),a.getPayPriceList({pay_type_cat_id:t.pay_type_cat_id,pay_type_id:t.pay_type_id}),a.hide_data_modal("price_type_modal"),a.add_PPD={city_ids:[],centers_ids:[],groups_ids:[]}):bootbox.alert(e.message),a.processing_req=!1})},a.editPayPriceData=function(e){a.add_PPD.id=e.id,a.add_PPD.price=e.price,a.add_PPD.tax=e.tax,a.add_PPD.total_amt=e.total,a.edit=!0,a.openAddPayPrice("price_type_modal")},a.updatePayPriceData=function(e){a.processing_req=!0,o.postCall(e,"/api/pay-type-price/update").then(function(e){e.success&&(a.getPayPriceList({pay_type_cat_id:e.entry.pay_type_cat_id,pay_type_id:e.entry.pay_type_id}),a.hide_data_modal("price_type_modal")),bootbox.alert(e.message),a.edit=!1,a.processing_req=!1})},a.deletePayPriceData=function(t){bootbox.confirm("Are you sure?",e=>{e&&o.postCall({id:t},"/api/pay-type-price/delete").then(function(e){e.success?(bootbox.alert(e.message),a.getPayPriceList({pay_type_cat_id:e.target.pay_type_cat_id,pay_type_id:e.target.pay_type_id}),a.hide_data_modal("price_type_modal")):bootbox.alert(e.message)})})}}]),app.controller("AcountsController",["$scope","$http","DBService","Upload",function(a,e,o,s){a.states={},a.gst={},a.listData={},a.editForm=!1,a.list=function(){o.postCall({},"/api/accounts/list").then(function(e){a.listData=e})},a.init=function(e){o.postCall({Tag:e},"/api/get-state-city-center-data").then(function(e){a.states=e.state}),a.list()},a.submit=function(e){e.id=0,a.processing=!0,o.postCall(e,"/api/accounts/save").then(function(e){e.success?(bootbox.alert(e.message),a.gst={},$("#contact_modal").modal("hide"),a.list()):bootbox.alert(e.message),a.processing=!1})},a.edit=function(e){console.log(e),a.editForm=!0,$("#contact_modal").modal("show"),a.gst=e,a.gst.show||(a.gst.show=!0)},a.update=function(e){a.processing=!0,o.postCall(e,"/api/accounts/save").then(function(e){e.success?(bootbox.alert(e.message),a.gst={},a.editForm=!1,$("#contact_modal").modal("hide"),a.list()):bootbox.alert(e.message),a.processing=!1})},a.delete=function(t){bootbox.confirm("Are you sure?",e=>{e&&o.postCall({id:t},"/api/accounts/delete").then(function(e){e.success?(bootbox.alert(e.message),a.list()):bootbox.alert(e.message)})})},a.hideModal=function(e){$("#"+e).modal("hide")},a.addAcount=function(){a.gst={},$("#contact_modal").modal("show")},a.uploadGstLogo=function(e){var t;a.logoProcessing=!0,e&&(a.uploading=!0,t=base_url+"/api/upload/photo",s.upload({url:t,data:{photo:e,resize:1,crop:0,width:720,thumb:1}}).then(function(e){e.data.success?a.gst.logo=e.data.path:alert(e.data.message),a.uploading=!1})),a.logoProcessing=!1},a.removeLogo=function(){a.gst.logo=""}}]),app.controller("Staff_Attendance_Controller",["$scope","$http","DBService","Upload",function(s,e,t,a){s.cityCenter={},s.filterData={show:!0},s.students=[],s.dates=[],s.loading=!0,s.processing=!1,s.getCityCenter=function(e){t.postCall({Tag:e},"/api/get-state-city-center-data").then(function(e){s.cityCenter=e,s.loading=!1})},s.getStaff=function(){s.processing=!0,t.postCall({city_id:s.filterData.city_id,month:s.filterData.month,year:s.filterData.year},"/api/users/attendance").then(function(e){s.dates=e.dates,s.staffMembers=e.staffMembers,s.processing=!1})},s.addSatffAttendance=function(e){for(var t=0;t<s.staffMembers.length;t++){var a=s.staffMembers[t].present.indexOf(e),o=s.staffMembers[t].absent.indexOf(e);-1==a&&s.staffMembers[t].present.push(e),-1<o&&s.staffMembers[t].absent.splice(o,1)}},s.switchStaffAttendance=function(e,t){var a=e.present.indexOf(t),o=e.absent.indexOf(t);-1==a&&-1==o?e.present.push(t):-1<a?(e.present.splice(a,1),e.absent.push(t)):-1<o&&e.absent.splice(a,1)},s.saveStaffAttendance=function(){s.saveprocessing=!0,t.postCall({staffMembers:s.staffMembers,dates:s.dates,city_id:s.filterData.city_id},"/api/users/attendance/save-attendance").then(function(e){e.success?(s.saveprocessing=!1,s.getStaff(),bootbox.alert(e.message)):(bootbox.alert(e.message),s.saveprocessing=!1)})}}]),app.controller("Parents_controller",["$scope","$http","DBService","Upload",function(t,e,a,o){t.sport_id=0,t.student={},t.state_city_center={},t.loading=!0,t.processing=!1,t.switchContent="payments",t.performance_category_id=0,t.attendance={weeks:[]},t.p_categories=[],t.month="",t.year="",t.init=function(e){t.student_id=e,a.postCall({student_id:e},"/api/parents/init").then(function(e){t.student=e.student,t.loading=!1,t.getAttendance(),t.getPerformanceReports(),t.getPerformanceGraph()})},t.switchContentFun=function(e){t.switchContent=e},t.getAttendance=function(){a.postCall({month:t.month,year:t.year},"/api/student/attendance/"+t.student_id).then(function(e){t.attendance.month_name=e.month_name,t.attendance.year=e.year,t.attendance.weeks=e.weeks,t.month=e.month,t.year=e.year})},t.prev_month=function(){t.month--,0==t.month&&(t.month=12,t.year--),t.getAttendance()},t.next_month=function(){t.month++,13==t.month&&(t.month=1,t.year++),t.getAttendance()},t.getPerformanceReports=function(){a.postCall({},"/api/student/reports/"+t.student_id).then(function(e){t.reports=e.reports})},t.getPerformanceGraph=function(){t.p_data={legends:[],labels:[],values:[]},t.loading_graph=!0,a.postCall({category_id:t.performance_category_id},"/api/student/performance-graph/"+t.student_id).then(function(e){t.p_data=e.p_data,t.p_categories=e.categories,t.loading_graph=!1})},t.viewSubscription=function(e){t.open_subscription={},a.getCall("/api/student/subscription/view/"+e).then(function(e){e.success?(t.open_subscription=e.subscription,$("#subModal").modal("show")):bootbox.alert(e.message)})},t.hide_data_modal=function(e){t.editModal=!1,$("#"+e).modal("hide")},t.editSubscription=function(e){t.open_subscription={},a.getCall("/api/student/subscription/view/"+e.id).then(function(e){e.success?(t.open_subscription=e.subscription,$("#pauseAddModal").modal("show")):bootbox.alert(e.message)})},t.addPause=function(){t.adding_pause=!0,t.pauseData.subscription_id=t.open_subscription.id,t.pauseData.student_id=t.student.id,a.postCall(t.pauseData,"/api/student/subscription/save").then(function(e){e.success&&(t.init(t.student.id),$("#pauseAddModal").modal("hide")),bootbox.alert(e.message),t.adding_pause=!1})}}]),app.controller("SalesDashboardCtrl",["$scope","$rootScope","DBService",function(t,e,a){t.filter={report_type:report_type,month:"",year:"",date_ref:""},t.cities=[],t.dates=[],t.weeks=[],t.layout=0,t.layout2=["cash_flow","demo_scheduled","demo_attended","verbal_confirmation","enrolled","renewed"],t.applyFilter=function(){t.processing=!0,a.postCall(t.filter,"/api/sales-dashboard/init").then(function(e){e.success&&(t.all_india=e.all_india,t.cities=e.cities,t.members=e.members,t.dates=e.dates,t.weeks=e.weeks,"lms_pending"==t.filter.report_type?t.layout=1:-1<t.layout2.indexOf(t.filter.report_type)?t.layout=2:t.layout=0),t.processing=!1})}}]),app.controller("ClientsController",["$scope","$http","DBService",function(o,e,s){o.addClinet={},o.clientsRecord={},o.update=!1,o.init=function(){s.postCall({},"/api/clients/list").then(function(e){o.clientsRecord=e.list})},o.addClient=function(){$("#client_modal").modal("show")},o.submit=function(){o.processing=!0,s.postCall(o.formData,"/api/clients/save").then(function(e){e.success&&(o.init(),$("#client_modal").modal("hide")),bootbox.alert(e.message),o.processing=!1})},o.edit=function(e){o.formData=JSON.parse(JSON.stringify(e)),$("#client_modal").modal("show")},o.delete=function(t,a){bootbox.confirm("Are you sure?",e=>{e&&s.getCall("/api/clients/delete/"+t).then(function(e){e.success&&(o.clientsRecord.splice(a,1),bootbox.alert(e.message))})})}}]),app.controller("events_controller",["$scope","$http","$timeout","Upload","DBService",function(o,e,t,s,a){o.formData={gallery:[]},o.processing=!1,o.filter={},o.loading=!1,o.id=0,o.getList=function(){o.loading=!0,a.postCall(o.filter,"/api/events/getList").then(function(e){o.events=e.events,o.loading=!1})},o.init=function(e){o.id=e,o.loading=!0,o.formData={hidden:0,pay_later:0,registration_closed:0},a.postCall({id:o.id},"/api/events/init").then(function(e){e.formData&&(o.formData=e.formData),o.cities=e.cities,o.loading=!1})},o.showEvent=function(e){o.open_event=e,$("#showEvent").modal("show")},o.uploadFile=function(e,t,a){a.uploading=!0;var o=base_url+"/api/events/uploadFile";s.upload({url:o,data:{media:e,name:t}}).then(function(e){console.log(e),e.data.success?a[t]=e.data.media:alert(e.data.message),a.uploading=!1},function(e){console.log("Error status: "+e.status),a.uploading=!1},function(e){})},o.removeFile=function(e){o.formData[e]="",console.log(o.formData)},o.uploadGalaryFile=function(e,t){o.uploading=!0;var a=base_url+"/api/events/upload-galary-image";angular.forEach(e,function(e){s.upload({url:a,data:{media:e}}).then(function(e){console.log(e.data),e.data.success?o.formData.gallery.push(e.data):alert(e.data.message),o.uploading=!1},function(e){o.uploading=!1},function(e){o.progress=parseInt(100*e.loaded/e.total)+"%"}),0})},o.removeGalleryImage=function(e){o.formData.gallery.splice(e,1)},o.addEvent=function(){o.formData.id=o.id,o.processing=!0,a.postCall(o.formData,"/api/events/add").then(function(e){e.success&&(o.formData={}),alert(e.message),o.processing=!1})}}]);